# 자율 개선 시스템 v4.0 시각적 가이드

**버전**: 4.0.0
**날짜**: 2025-10-13
**대상**: 비프로그래머, 일반 사용자

---

## 📖 이 문서는 무엇인가요?

수학 교육 AI 시스템이 스스로를 개선하는 방법을 설명합니다.
프로그래밍 지식이 없어도 전체 흐름을 이해할 수 있도록 작성되었습니다.

**핵심 아이디어**: AI가 자기 자신의 문제를 발견하고, 원인을 분석하고, 스스로 고칩니다.

---

## 🎯 전체 시스템 구조

```
┌─────────────────────────────────────────────────────────────┐
│                    사용자 (학생 또는 교사)                     │
│                "수학 문제를 도와주세요"                         │
└────────────────────────┬────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────┐
│              Meta-Orchestrator (지휘자 AI)                   │
│                                                              │
│  ┌──────────────────┐        ┌──────────────────┐          │
│  │   일반 모드      │        │   개선 모드      │          │
│  │                  │        │                  │          │
│  │ 6개 전문 AI에게  │        │ 스스로 문제를    │          │
│  │ 작업 분배        │        │ 발견하고 고침    │          │
│  └──────────────────┘        └──────────────────┘          │
└────────────────┬──────────────────────┬─────────────────────┘
                 │                      │
    ┌────────────▼─────────┐   ┌────────▼──────────────────┐
    │  일반 작업 흐름      │   │  자율 개선 흐름          │
    └──────────────────────┘   └──────────────────────────┘
                 │                      │
                 ▼                      ▼
    ┌──────────────────────┐   ┌──────────────────────────┐
    │ 6개 전문 AI 에이전트  │   │ Socratic-Mediator        │
    │                      │   │ (문제 분석가)             │
    │ • 지식 구축          │   │         ↓                │
    │ • 품질 검사          │   │ Self-Improver            │
    │ • 자료 조사          │   │ (자동 수리공)             │
    │ • 예시 생성          │   │         ↓                │
    │ • 관계 매핑          │   │ Improvement Manager      │
    │ • 소크라테스 대화    │   │ (변경 이력 기록)          │
    └──────────────────────┘   └──────────────────────────┘
```

---

## 🌟 핵심 개선사항 5가지 (쉬운 설명)

### 1. 의존성 분석 시스템 (Dependency Analysis)

**비유**: 건물 설계도 분석기

```
옛날 방식:
"이 벽을 고치면 어디에 영향이 갈까?" → 사람이 일일이 확인

새 방식:
컴퓨터가 건물 전체 설계도를 분석해서
"이 벽을 고치면 2층 거실과 3층 계단에 영향갑니다" → 자동 파악
```

**무엇이 좋아졌나요?**
- 코드 하나를 고칠 때 영향받는 다른 코드들을 자동으로 찾아냄
- 실수로 다른 부분을 망가뜨리는 일을 방지
- 속도: 사람이 하면 몇 시간 → 컴퓨터가 하면 1초

---

### 2. 영향 범위 계산 (Change Impact Analysis)

**비유**: 파급 효과 시뮬레이터

```
┌─────────────────────────────────────────────┐
│  변경 계획: "AI 에이전트 A의 온도 조절"     │
└───────────────┬─────────────────────────────┘
                │
                ▼
┌─────────────────────────────────────────────┐
│  영향 받는 것들 자동 계산                   │
│                                             │
│  ✓ 직접 영향: AI 에이전트 B, C             │
│  ✓ 간접 영향: AI 에이전트 D (B를 통해)     │
│  ✓ 중요도: B는 핵심 시스템 (주의 필요)      │
│  ✓ 테스트: 80% 테스트로 보호됨              │
└─────────────────────────────────────────────┘
```

**무엇이 좋아졌나요?**
- 변경 전에 미리 "어디까지 영향이 가는지" 알 수 있음
- 중요한 부분에 손대는지 자동으로 감지
- 안전하게 변경할 수 있는지 판단

---

### 3. 품질 게이트 (Quality Gate)

**비유**: 자동 검수 시스템

```
                    ┌─────────┐
                    │ 변경안  │
                    └────┬────┘
                         │
                         ▼
              ┌──────────────────────┐
              │   품질 게이트 통과?   │
              └──────────┬───────────┘
                         │
              ┌──────────┴──────────┐
              ▼                     ▼
        ┌───────────┐         ┌───────────┐
        │  통과 ✓   │         │  거부 ✗   │
        │           │         │           │
        │ → 적용    │         │ → 재검토  │
        └───────────┘         └───────────┘

검사 항목:
□ 영향 범위가 20개 파일 미만인가? (폭발 반경 제한)
□ 테스트 커버리지가 80% 이상인가? (안전망 확인)
□ 핵심 시스템을 건드리지 않는가? (위험 방지)
```

**무엇이 좋아졌나요?**
- 사람이 일일이 확인하지 않아도 자동으로 안전성 검사
- 위험한 변경은 자동으로 막아줌
- 기준이 명확해서 일관성 유지

---

### 4. 재시도 전략 (Dynamic Feedback Loop)

**비유**: 똑똑한 재시도 시스템

```
상황 1: 일반적인 개선
┌────────────────┐
│ 1차 시도       │ → 성공 ✓ → 완료
│ (1회만 시도)   │ → 실패 ✗ → 롤백 후 종료
└────────────────┘

상황 2: 중요한 개선 (핵심 시스템 관련)
┌────────────────┐
│ 1차 시도       │ → 성공 ✓ → 완료
│ (2회까지 시도) │ → 실패 ✗ → ┐
└────────────────┘            │
                              ▼
                    ┌────────────────┐
                    │ 롤백 후 재시도 │
                    │ 2차 시도       │ → 성공/실패
                    └────────────────┘
```

**규칙**:
- 영향받는 AI가 2개 이상 + 핵심 시스템 포함 → 2회 재시도
- 그 외의 경우 → 1회만 시도

**무엇이 좋아졌나요?**
- 중요한 변경은 더 신중하게 처리 (2번 기회)
- 불필요한 재시도로 시간 낭비하지 않음
- 실패 시 자동으로 이전 상태로 복구

---

### 5. 대화 기록 저장 (Socratic Logging)

**비유**: 자동 회의록 작성

```
Socratic-Mediator가 문제 분석하는 과정:

Turn 1:
Q: "지식 구축 AI야, 최근 어떤 오류가 발생했니?"
A: "수학 공식 처리에서 3번 연속 실패했습니다."

Turn 2:
Q: "품질 검사 AI야, 그 공식들의 품질은 어땠니?"
A: "형식은 맞지만 변수 처리에 문제가 있었습니다."

...

→ 이 모든 대화가 자동으로 파일에 저장됨
→ 파일 위치: /home/kc-palantir/math/dependency-map/
→ 형식: Markdown (읽기 쉬운 문서 형태)
```

**무엇이 좋아졌나요?**
- 어떻게 문제를 분석했는지 추후 확인 가능
- 디버깅할 때 참고 자료로 활용
- 투명성: AI가 어떻게 생각했는지 볼 수 있음

---

## 🔄 전체 실행 흐름 (단계별 시각화)

```
[1단계] 문제 감지
─────────────────────────────────────────────────
Meta-Orchestrator: "AI 에이전트 X의 성공률이 65%로 낮아졌네요"
                   "에러가 3번 연속 발생했어요"

        ↓

[2단계] 근본 원인 분석
─────────────────────────────────────────────────
Socratic-Mediator 시작:

"AI X야, 최근 어떤 작업을 했니?"
"다른 AI들아, X와 협업할 때 문제 없었니?"
...
(최대 10번 질문하며 원인 추적)

결과: "온도 설정이 0.7로 너무 높아서 일관성 없는 답변 생성"
      신뢰도: 85%

대화 전체가 Markdown 파일로 자동 저장됨 ✓

        ↓

[3단계] 영향 범위 분석
─────────────────────────────────────────────────
Dependency Agent 작동:

"X를 고치면 어디에 영향이 가나?"
→ 설계도 분석 (캐시에서 불러옴, 1초 소요)

결과:
- 영향받는 AI: 2개 (Y, Z)
- 핵심 시스템 포함: 예
- 테스트 커버리지: 85%

        ↓

[4단계] 품질 게이트 검사
─────────────────────────────────────────────────
자동 검사:

✓ 영향 범위 < 20개 파일
✓ 테스트 커버리지 > 80%
⚠ 핵심 시스템 영향 → 2회 검증 필요

결과: 통과 (단, 2회 재시도 모드)

        ↓

[5단계] 개선 적용 (피드백 루프)
─────────────────────────────────────────────────
라운드 1:
  Self-Improver: "온도를 0.7 → 0.5로 변경합니다"
  변경 적용 ✓

  검증 테스트: "피타고라스 정리를 설명해줘" 실행
  결과: 성공 ✓

  → 완료! (2라운드 불필요)

만약 실패했다면:
  → 롤백 (0.7로 되돌림)
  → 라운드 2 시도 (다른 방법으로)

        ↓

[6단계] 완료 및 기록
─────────────────────────────────────────────────
Improvement Manager에 기록:
- 변경 내용: 온도 0.7 → 0.5
- 대상: AI 에이전트 X
- 시간: 2025-10-13 15:30:00
- 상태: 성공
- 이유: 일관성 개선

사용자에게 보고: "AI X가 개선되었습니다!"
```

---

## 🛡️ 안전 장치 (5중 보호)

### 체크리스트

```
□ [1단계] 변경 횟수 제한
  ✓ 한 번에 최대 5개까지만 개선 가능
  ✓ 너무 많은 변경으로 시스템 불안정해지는 것 방지

□ [2단계] 신뢰도 검증
  ✓ 신뢰도 70% 이상일 때만 적용
  ✓ 확실하지 않은 변경은 하지 않음

□ [3단계] 품질 게이트
  ✓ 영향 범위가 너무 크면 거부 (20개 파일 제한)
  ✓ 테스트가 부족하면 거부 (80% 커버리지 필요)
  ✓ 핵심 시스템은 2배 검증

□ [4단계] 자동 롤백
  ✓ 검증 테스트 실패 시 즉시 이전 상태로 복구
  ✓ 변경 전 상태를 항상 저장해둠

□ [5단계] 완전한 기록
  ✓ 모든 변경 이력을 영구 저장
  ✓ 언제든지 과거로 되돌아갈 수 있음
  ✓ 누가, 언제, 왜, 무엇을 바꿨는지 추적 가능
```

---

## 📚 용어 사전 (기술 용어를 쉽게)

### A

**Agent (에이전트)**
- 쉬운 말: AI 일꾼
- 예: "지식 구축 에이전트"는 수학 지식을 만드는 AI 일꾼

**AST (Abstract Syntax Tree)**
- 쉬운 말: 코드 설계도
- 예: 건물 설계도처럼 코드의 구조를 나타내는 그림

### C

**CIA (Change Impact Analysis)**
- 쉬운 말: 영향 범위 계산
- 예: "이것을 고치면 저것도 영향받아요" 를 자동으로 계산

**CIS (Candidate Impact Set)**
- 쉬운 말: 영향받을 수 있는 것들의 목록
- 예: A를 고치면 B, C, D가 영향받음 → {B, C, D}가 CIS

**Critical Component (핵심 컴포넌트)**
- 쉬운 말: 시스템의 심장
- 예: 지식 구축 AI, 품질 검사 AI처럼 망가지면 큰일나는 부분

### D

**Dependency (의존성)**
- 쉬운 말: "A가 B를 필요로 함" 관계
- 예: 자동차는 엔진에 의존함 → 엔진 고장나면 자동차 멈춤

**Dependency Agent (의존성 분석 AI)**
- 쉬운 말: 설계도 분석가
- 예: 누가 누구를 필요로 하는지 지도를 만드는 AI

### F

**Feedback Loop (피드백 루프)**
- 쉬운 말: "시도 → 확인 → 필요하면 다시 시도" 반복
- 예: 요리할 때 맛보고 조절하는 것과 비슷

### I

**Impact Analysis (영향 분석)**
- 쉬운 말: 파급 효과 조사
- 예: 댐을 지으면 주변에 어떤 영향이 있는지 조사

**Improvement Manager (개선 관리자)**
- 쉬운 말: 변경 이력 기록부
- 예: 언제, 무엇을, 왜 바꿨는지 일기장처럼 기록

### M

**Meta-Orchestrator (메타 오케스트레이터)**
- 쉬운 말: 지휘자 AI
- 예: 오케스트라 지휘자처럼 여러 AI를 조종하는 리더 AI

**Mission-Critical (미션 크리티컬)**
- 쉬운 말: 매우 중요한
- 예: 병원의 응급실, 비행기의 엔진처럼 절대 망가지면 안 되는 것

### Q

**Quality Gate (품질 게이트)**
- 쉬운 말: 자동 검수대
- 예: 공장에서 불량품을 걸러내는 검사대

### R

**Rollback (롤백)**
- 쉬운 말: 되돌리기 (Ctrl+Z)
- 예: 실수했을 때 이전 저장 시점으로 돌아가기

**Root Cause (근본 원인)**
- 쉬운 말: 진짜 이유
- 예: 기침의 근본 원인은 감기 바이러스

### S

**SIS (Starting Impact Set)**
- 쉬운 말: 고치려는 대상
- 예: "AI 에이전트 A의 온도를 고친다" → A가 SIS

**Socratic-Mediator (소크라테스 중재자)**
- 쉬운 말: 질문으로 진실을 찾는 AI
- 예: 소크라테스처럼 계속 질문해서 문제의 진짜 원인을 찾음

**Static Analysis (정적 분석)**
- 쉬운 말: 실행하지 않고 분석
- 예: 건물 설계도만 보고 구조를 분석 (실제로 짓지 않아도)

### V

**Verification Test (검증 테스트)**
- 쉬운 말: 제대로 고쳐졌는지 확인
- 예: 자동차 수리 후 시운전해보는 것

---

## 📈 성능 비교

### v3.0 vs v4.0

| 기능 | v3.0 | v4.0 | 개선 효과 |
|------|------|------|-----------|
| 의존성 분석 | 사람이 수동으로 | 자동 (1초) | ⚡ 수백배 빠름 |
| 영향 범위 파악 | 추측으로 판단 | 정확한 계산 | ✓ 정확도 100% |
| 안전성 검사 | 간단한 확인 | 5중 보호 장치 | 🛡️ 훨씬 안전 |
| 재시도 전략 | 항상 1회 | 중요도에 따라 1-2회 | 🎯 더 똑똑함 |
| 대화 기록 | 기본 로그 | 구조화된 문서 | 📝 이해하기 쉬움 |

### 실제 사용 예시

**상황**: 지식 구축 AI가 수학 공식 처리에서 실패

```
v3.0 방식:
1. 사람이 로그를 보고 문제 추측 (30분)
2. 코드 수정 (1시간)
3. 테스트 (30분)
4. 다른 부분 망가졌는지 확인 (1시간)
───────────────────────────────────
총 시간: 3시간, 실수 위험: 높음

v4.0 방식:
1. 자동으로 문제 감지 (즉시)
2. AI가 원인 분석 (5분)
3. AI가 수정 + 영향 분석 (2분)
4. 자동 검증 (1분)
───────────────────────────────────
총 시간: 8분, 실수 위험: 낮음 (자동 롤백)
```

---

## ✨ 요약

### 핵심 3줄 요약

1. **AI가 스스로 문제를 발견하고 원인을 분석합니다** (Socratic-Mediator)
2. **안전하게 수정할 수 있는지 자동으로 확인합니다** (품질 게이트 + 영향 분석)
3. **실패하면 자동으로 되돌리고, 모든 과정을 기록합니다** (롤백 + 이력 관리)

### 왜 이게 혁신적인가?

전통적인 방식:
```
문제 발생 → 사람이 분석 → 사람이 수정 → 사람이 테스트
(시간: 수 시간~수 일, 실수 가능성: 높음)
```

v4.0 방식:
```
문제 발생 → AI가 자동 분석 → AI가 자동 수정 → AI가 자동 검증
(시간: 수 분, 실수 가능성: 낮음, 완전한 기록)
```

### 실생활 비유

마치 **자가 치유하는 생명체**와 같습니다:

- 🩹 상처 감지: 문제를 자동으로 발견
- 🔬 진단: AI가 원인 분석
- 💊 치료: AI가 수정
- 🏥 재검사: 자동 검증
- 📋 의료 기록: 모든 과정 저장

---

## 🎓 더 알아보기

### 이 시스템이 하지 않는 것

❌ 사람을 대체하지 않습니다
   → 중요한 결정은 여전히 사람이 승인

❌ 완벽하지 않습니다
   → 실패할 수 있지만, 자동으로 되돌립니다

❌ 무한정 개선하지 않습니다
   → 한 번에 최대 5개, 신뢰도 70% 이상만

### 이 시스템이 하는 것

✅ 반복적인 문제 해결 자동화
✅ 안전한 변경 (5중 보호 장치)
✅ 완전한 추적 가능성 (모든 것 기록)
✅ 투명한 의사결정 (대화 로그 저장)

---

## 📞 문의

더 자세한 기술 문서:
- 영문 개발자용: `SELF-IMPROVEMENT-IMPLEMENTATION-PLAN-v4.0.md`
- 공식 문서: https://docs.claude.com/en/api/agent-sdk/python

---

**마지막 업데이트**: 2025-10-13
**문서 버전**: 4.0.0
**상태**: 최종 확정

---

# 부록: 다이어그램 모음

## A. 전체 시스템 흐름도

```
┌──────────────────────────────────────────────────────────────────┐
│                          사용자 입력                              │
│                   "수학 문제 도와주세요"                           │
└────────────────────────────┬─────────────────────────────────────┘
                             │
                             ▼
          ┌──────────────────────────────────────┐
          │     Meta-Orchestrator 판단           │
          │                                      │
          │  "일반 질문?" or "개선 필요?"         │
          └───────────┬─────────────┬────────────┘
                      │             │
         ┌────────────▼─┐       ┌───▼──────────────┐
         │  일반 모드   │       │   개선 모드       │
         └────────────┬─┘       └───┬──────────────┘
                      │             │
                      ▼             ▼
         ┌─────────────────────────────────────┐
         │    6개 전문 AI 에이전트 실행       │
         │                                     │
         │  [지식구축] [품질] [조사]          │
         │  [예시] [관계] [대화]              │
         └────────────┬────────────────────────┘
                      │
                      ▼
         ┌─────────────────────────────────────┐
         │        결과 통합 및 반환            │
         └─────────────────────────────────────┘
```

## B. 자율 개선 사이클 상세도

```
┌─ STEP 1: 문제 감지 ──────────────────────────────────┐
│                                                       │
│  Performance Monitor: "에러율 30% 초과!"             │
│  Meta-Orchestrator: "개선 사이클 시작"                │
│                                                       │
└───────────────────────┬───────────────────────────────┘
                        │
                        ▼
┌─ STEP 2: 근본 원인 분석 ─────────────────────────────┐
│                                                       │
│  Socratic-Mediator 작동:                             │
│                                                       │
│  Turn 1: "AI A에게 질문" → 답변 받음                 │
│  Turn 2: "AI B에게 질문" → 답변 받음                 │
│  Turn 3: "AI C에게 질문" → 답변 받음                 │
│  ...                                                  │
│  Turn N: 최종 분석 완료                               │
│                                                       │
│  결과: "근본 원인은 온도 설정 문제"                   │
│  대화 로그 자동 저장 ✓                                │
│                                                       │
└───────────────────────┬───────────────────────────────┘
                        │
                        ▼
┌─ STEP 3: 영향 분석 ──────────────────────────────────┐
│                                                       │
│  Dependency Agent 작동:                               │
│                                                       │
│  1. 캐시된 설계도 불러오기 (0.1초)                    │
│  2. A를 고치면 영향받는 것들 찾기                     │
│     → B, C 발견                                       │
│  3. B는 핵심 시스템! (주의 필요)                      │
│                                                       │
│  결과:                                                │
│  - 영향 받는 AI: 2개                                 │
│  - 핵심 포함: 예                                     │
│  - 테스트 커버리지: 85%                               │
│                                                       │
└───────────────────────┬───────────────────────────────┘
                        │
                        ▼
┌─ STEP 4: 품질 게이트 ────────────────────────────────┐
│                                                       │
│  자동 검사:                                           │
│                                                       │
│  ✓ 영향 범위 < 20개 파일? → OK                       │
│  ✓ 테스트 > 80%? → OK                                │
│  ⚠ 핵심 시스템 영향? → 2라운드 필요                  │
│                                                       │
│  결과: 통과 (조건부)                                  │
│                                                       │
└───────────────────────┬───────────────────────────────┘
                        │
                        ▼
┌─ STEP 5: 피드백 루프 ────────────────────────────────┐
│                                                       │
│  라운드 1:                                            │
│  ┌─────────────────────────────────┐                │
│  │ Self-Improver: 온도 0.7→0.5     │                │
│  │ 변경 적용 ✓                      │                │
│  │                                  │                │
│  │ 검증 테스트 실행...              │                │
│  │ "피타고라스 정리 설명해줘"       │                │
│  │                                  │                │
│  │ 결과: 성공 ✓                     │                │
│  └─────────────────────────────────┘                │
│                                                       │
│  → 라운드 1에서 성공! 완료                            │
│                                                       │
│  만약 실패했다면:                                     │
│  → 롤백 (0.7로 복구)                                 │
│  → 라운드 2 시도                                     │
│                                                       │
└───────────────────────┬───────────────────────────────┘
                        │
                        ▼
┌─ STEP 6: 완료 및 기록 ───────────────────────────────┐
│                                                       │
│  Improvement Manager에 기록:                          │
│                                                       │
│  - 변경 ID: a1b2c3d4                                 │
│  - 대상: AI 에이전트 A                                │
│  - 변경: 온도 0.7 → 0.5                              │
│  - 시간: 2025-10-13 15:30:00                         │
│  - 상태: 성공 ✓                                      │
│  - 이유: 일관성 향상                                  │
│                                                       │
│  사용자 알림: "개선 완료!"                            │
│                                                       │
└───────────────────────────────────────────────────────┘
```

## C. 안전 장치 5단계

```
┌──────────────────────────────────────────────────────────────┐
│                         변경 시도                             │
└───────────────────────┬──────────────────────────────────────┘
                        │
                        ▼
┌─ 1단계: 횟수 제한 ────────────────────────────────────────────┐
│                                                                │
│  현재: 3/5 개 개선 완료                                        │
│  상태: ✓ 통과 (5개 미만)                                       │
│                                                                │
└───────────────────────┬────────────────────────────────────────┘
                        │
                        ▼
┌─ 2단계: 신뢰도 검증 ──────────────────────────────────────────┐
│                                                                │
│  원인 분석 신뢰도: 85%                                         │
│  요구 사항: > 70%                                              │
│  상태: ✓ 통과                                                  │
│                                                                │
└───────────────────────┬────────────────────────────────────────┘
                        │
                        ▼
┌─ 3단계: 품질 게이트 ──────────────────────────────────────────┐
│                                                                │
│  ✓ 영향 범위: 2개 파일 (< 20개)                               │
│  ✓ 테스트 커버리지: 85% (> 80%)                                │
│  ⚠ 핵심 시스템 포함                                            │
│                                                                │
│  상태: ✓ 조건부 통과 (2라운드 검증)                            │
│                                                                │
└───────────────────────┬────────────────────────────────────────┘
                        │
                        ▼
┌─ 4단계: 자동 검증 ────────────────────────────────────────────┐
│                                                                │
│  변경 적용 후 테스트:                                          │
│                                                                │
│  Test 1: "피타고라스 정리" → ✓ 통과                           │
│  Test 2: "미적분 기본 정리" → ✓ 통과                          │
│                                                                │
│  성능: 평균 500ms (이전: 600ms) → ✓ 개선                      │
│                                                                │
│  상태: ✓ 검증 통과                                             │
│                                                                │
│  만약 실패했다면 → 자동 롤백                                   │
│                                                                │
└───────────────────────┬────────────────────────────────────────┘
                        │
                        ▼
┌─ 5단계: 이력 기록 ────────────────────────────────────────────┐
│                                                                │
│  영구 저장:                                                    │
│                                                                │
│  {                                                             │
│    "change_id": "abc123",                                      │
│    "timestamp": "2025-10-13T15:30:00",                         │
│    "agent": "AI-A",                                            │
│    "action": "온도 조정",                                       │
│    "before": 0.7,                                              │
│    "after": 0.5,                                               │
│    "reason": "일관성 향상",                                     │
│    "status": "성공",                                            │
│    "rollback_available": true                                  │
│  }                                                             │
│                                                                │
│  상태: ✓ 기록 완료                                             │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

---

**끝 - 모든 내용을 이해하셨기를 바랍니다! 🎉**
