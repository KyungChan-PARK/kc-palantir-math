# ìˆ˜í•™ êµìœ¡ ì‹œìŠ¤í…œ ì™„ì „ ê°€ì´ë“œ (ì´ˆë³´ììš©)

> **í”„ë¡œê·¸ë˜ë° ì²˜ìŒ ì ‘í•˜ì‹œëŠ” ë¶„ë“¤ì„ ìœ„í•œ ì™„ì „ ë¶„ì„**
> ì´ ë¬¸ì„œëŠ” main.pyë¶€í„° ì‹œì‘í•´ì„œ ëª¨ë“  íŒŒì¼ì´ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ì„¤ëª…í•©ë‹ˆë‹¤.

---

## ğŸ“š ëª©ì°¨

1. [í”„ë¡œê·¸ë¨ ì‹œì‘ë¶€í„° ëê¹Œì§€](#1-í”„ë¡œê·¸ë¨-ì‹œì‘ë¶€í„°-ëê¹Œì§€)
2. [íŒŒì¼ êµ¬ì¡° í•œëˆˆì— ë³´ê¸°](#2-íŒŒì¼-êµ¬ì¡°-í•œëˆˆì—-ë³´ê¸°)
3. [ê° íŒŒì¼ì˜ ì—­í• ](#3-ê°-íŒŒì¼ì˜-ì—­í• )
4. [ì»´í¬ë„ŒíŠ¸ ìƒí˜¸ì‘ìš©](#4-ì»´í¬ë„ŒíŠ¸-ìƒí˜¸ì‘ìš©)
5. [ì½”ë“œ ë ˆë²¨ ìƒì„¸ ë¶„ì„](#5-ì½”ë“œ-ë ˆë²¨-ìƒì„¸-ë¶„ì„)

---

## 1. í”„ë¡œê·¸ë¨ ì‹œì‘ë¶€í„° ëê¹Œì§€

### ğŸ¬ ì‹¤í–‰ íë¦„ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì‚¬ìš©ìê°€ í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰: python main.py                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1ë‹¨ê³„: í”„ë¡œê·¸ë¨ ì‹œì‘ (main.py ìµœí•˜ë‹¨)                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  if __name__ == "__main__":                                      â”‚
â”‚      nest_asyncio.apply()        # ë¹„ë™ê¸° ì²˜ë¦¬ ì¤€ë¹„              â”‚
â”‚      asyncio.run(main())         # main() í•¨ìˆ˜ ì‹¤í–‰              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2ë‹¨ê³„: ì´ˆê¸°í™” (main() í•¨ìˆ˜ ì‹œì‘)                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â‘  load_dotenv()                 # .env íŒŒì¼ì—ì„œ ì„¤ì • ì½ê¸°       â”‚
â”‚  â‘¡ print("í™˜ì˜ ë©”ì‹œì§€")          # ì‹œìŠ¤í…œ ì •ë³´ ì¶œë ¥              â”‚
â”‚  â‘¢ Infrastructure ì´ˆê¸°í™” (ì„ íƒ)                                  â”‚
â”‚     - StructuredLogger           # ë¡œê·¸ ê¸°ë¡                     â”‚
â”‚     - PerformanceMonitor         # ì„±ëŠ¥ ì¸¡ì •                     â”‚
â”‚     - ErrorTracker               # ì—ëŸ¬ ì¶”ì                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3ë‹¨ê³„: AI ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ ì„¤ì •                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  ClaudeAgentOptions ìƒì„±:                                        â”‚
â”‚  - model: "claude-sonnet-4-5"    # ì–´ë–¤ AI ëª¨ë¸ ì‚¬ìš©í• ì§€         â”‚
â”‚  - system_prompt: .claude/CLAUDE.mdë¥¼ ì½ì–´ì„œ ì„¤ì •                â”‚
â”‚  - allowed_tools: [Task, Read, Write, Edit, ...]                â”‚
â”‚  - agents: { 11ê°œ subagent ë“±ë¡ }                               â”‚
â”‚  - mcp_servers: { memory-keeper, sequential-thinking }          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4ë‹¨ê³„: ëŒ€í™” ì‹œìŠ¤í…œ ì‹œì‘                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  async with ClaudeSDKClient(options) as client:                  â”‚
â”‚      while True:  â† ë¬´í•œ ë°˜ë³µ (ì‚¬ìš©ìê°€ ì¢…ë£Œí•  ë•Œê¹Œì§€)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5ë‹¨ê³„: ì‚¬ìš©ì ì…ë ¥ ëŒ€ê¸°                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  user_input = input("You: ")    # ì‚¬ìš©ì ì§ˆë¬¸ ê¸°ë‹¤ë¦¼              â”‚
â”‚                                                                  â”‚
â”‚  ë§Œì•½ "exit"ì„ ì…ë ¥í•˜ë©´ â†’ í”„ë¡œê·¸ë¨ ì¢…ë£Œ                           â”‚
â”‚  ë§Œì•½ ë¹ˆ ì¤„ì´ë©´ â†’ ë‹¤ì‹œ ì…ë ¥ ëŒ€ê¸°                                  â”‚
â”‚  ê·¸ ì™¸ â†’ ë‹¤ìŒ ë‹¨ê³„ë¡œ                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6ë‹¨ê³„: AIì—ê²Œ ì§ˆë¬¸ ì „ì†¡                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  await client.query(user_input)  # ì‚¬ìš©ì ì§ˆë¬¸ì„ AIì—ê²Œ ë³´ëƒ„      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7ë‹¨ê³„: AI ì‘ë‹µ ë°›ê¸° ë° ì¶œë ¥                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  async for message in client.receive_response():                â”‚
â”‚      if TextBlock:         â†’ í…ìŠ¤íŠ¸ ì¶œë ¥                         â”‚
â”‚      if ThinkingBlock:     â†’ "ğŸ§  ìƒê° ì¤‘..." ì¶œë ¥                â”‚
â”‚      if ToolUseBlock:      â†’ "ğŸ”§ ë„êµ¬ ì‚¬ìš© ì¤‘..." ì¶œë ¥           â”‚
â”‚      if ResultMessage:     â†’ "âœ… ì™„ë£Œ" ì¶œë ¥                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
                  5ë‹¨ê³„ë¡œ ëŒì•„ê° (ë‹¤ìŒ ì§ˆë¬¸ ëŒ€ê¸°)
```

### ğŸ” **ì´ˆë³´ìë¥¼ ìœ„í•œ ì„¤ëª…**

**1. python main.pyë¥¼ ì‹¤í–‰í•˜ë©´?**
- ì»´í“¨í„°ê°€ main.py íŒŒì¼ì„ ì½ê¸° ì‹œì‘í•©ë‹ˆë‹¤
- íŒŒì¼ ë§¨ ì•„ë˜ `if __name__ == "__main__":` ë¶€ë¶„ì´ ì‹¤í–‰ë©ë‹ˆë‹¤
- ì´ê²ƒì€ "ì´ íŒŒì¼ì´ ì§ì ‘ ì‹¤í–‰ë  ë•Œë§Œ ì•„ë˜ ì½”ë“œë¥¼ ì‹¤í–‰í•´ë¼"ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤

**2. asyncio.run(main())ì´ë€?**
- `async`ëŠ” "ë¹„ë™ê¸°"ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤
- ì—¬ëŸ¬ ì‘ì—…ì„ ë™ì‹œì— ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤
- ì˜ˆ: AIê°€ ìƒê°í•˜ëŠ” ë™ì•ˆ ë‹¤ë¥¸ ì‘ì—…ë„ í•  ìˆ˜ ìˆìŒ

**3. while TrueëŠ” ë¬´í•œ ë£¨í”„**
- "TrueëŠ” í•­ìƒ ì°¸"ì´ë¯€ë¡œ ë¬´í•œíˆ ë°˜ë³µë©ë‹ˆë‹¤
- ì‚¬ìš©ìê°€ "exit"ì„ ì…ë ¥í•˜ê±°ë‚˜ Ctrl+Cë¥¼ ëˆ„ë¥´ë©´ ì¢…ë£Œë©ë‹ˆë‹¤

**4. await client.query()ëŠ” ê¸°ë‹¤ë¦¼**
- AIì—ê²Œ ì§ˆë¬¸ì„ ë³´ë‚´ê³  ë‹µë³€ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤
- `await`ì€ "ì´ ì‘ì—…ì´ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤"ë¼ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤

---

## 2. íŒŒì¼ êµ¬ì¡° í•œëˆˆì— ë³´ê¸°

```
/home/kc-palantir/math/              â† í”„ë¡œì íŠ¸ ë£¨íŠ¸ (ìµœìƒìœ„ í´ë”)
â”‚
â”œâ”€â”€ main.py                          â˜… ì§„ì…ì  (í”„ë¡œê·¸ë¨ ì‹œì‘ì )
â”œâ”€â”€ config.py                        â˜… ì„¤ì • íŒŒì¼ (ê²½ë¡œ, ë””ë ‰í† ë¦¬)
â”‚
â”œâ”€â”€ subagents/                       â˜… 11ê°œ ì „ë¬¸ AI ì—ì´ì „íŠ¸
â”‚   â”œâ”€â”€ __init__.py                  â†’ 11ê°œ agentë¥¼ í•˜ë‚˜ë¡œ ëª¨ìŒ
â”‚   â”œâ”€â”€ file_builder_agent.py        â†’ íŒŒì¼ ìƒì„± ì „ë¬¸ê°€
â”‚   â”œâ”€â”€ validator_agent.py           â†’ í’ˆì§ˆ ê²€ì¦ ì „ë¬¸ê°€
â”‚   â”œâ”€â”€ web_research_agent.py        â†’ ì›¹ ê²€ìƒ‰ ì „ë¬¸ê°€
â”‚   â”œâ”€â”€ requirements_agent.py        â†’ ìš”êµ¬ì‚¬í•­ ëª…í™•í™” ì „ë¬¸ê°€
â”‚   â”œâ”€â”€ graph_query_agent.py         â†’ ê·¸ë˜í”„DB ì „ë¬¸ê°€
â”‚   â”œâ”€â”€ decomposer_agent.py          â†’ ë¬¸ì œ ë¶„í•´ ì „ë¬¸ê°€
â”‚   â”œâ”€â”€ problem_generator_agent.py   â†’ ë¬¸ì œ ìƒì„± ì „ë¬¸ê°€
â”‚   â”œâ”€â”€ personalization_agent.py     â†’ ê°œì¸í™” ì „ë¬¸ê°€
â”‚   â”œâ”€â”€ code_improver_agent.py       â†’ ì½”ë“œ ê°œì„  ì „ë¬¸ê°€
â”‚   â”œâ”€â”€ planning_analyzer_agent.py   â†’ ê³„íš ë¶„ì„ ì „ë¬¸ê°€
â”‚   â””â”€â”€ query_helper_agent.py        â†’ ì¿¼ë¦¬ ë„ìš°ë¯¸
â”‚
â”œâ”€â”€ infrastructure/                  â˜… ì‹œìŠ¤í…œ ì§€ì› ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ __init__.py                  â†’ ëª¨ë“  ì„œë¹„ìŠ¤ë¥¼ í•˜ë‚˜ë¡œ ëª¨ìŒ
â”‚   â”œâ”€â”€ logging_service.py           â†’ ë¡œê·¸ ê¸°ë¡ (ëˆ„ê°€ ì–¸ì œ ë­˜ í–ˆëŠ”ì§€)
â”‚   â”œâ”€â”€ monitoring_service.py        â†’ ì„±ëŠ¥ ì¸¡ì • (ì–¼ë§ˆë‚˜ ë¹ ë¥¸ì§€)
â”‚   â”œâ”€â”€ error_service.py             â†’ ì—ëŸ¬ ì²˜ë¦¬ (ë¬¸ì œ ìƒê¸°ë©´ ì¬ì‹œë„)
â”‚   â”œâ”€â”€ context_service.py           â†’ ëŒ€í™” ë§¥ë½ ê´€ë¦¬
â”‚   â””â”€â”€ registry_service.py          â†’ ì—ì´ì „íŠ¸ ë“±ë¡ë¶€
â”‚
â”œâ”€â”€ tools/                           â˜… ìœ í‹¸ë¦¬í‹° ë„êµ¬ë“¤
â”‚   â”œâ”€â”€ weight_calculator_tool.py    â†’ ê°€ì¤‘ì¹˜ ê³„ì‚°
â”‚   â”œâ”€â”€ feedback_collector_tool.py   â†’ í”¼ë“œë°± ìˆ˜ì§‘
â”‚   â”œâ”€â”€ log_optimizer_tool.py        â†’ ë¡œê·¸ ìµœì í™”
â”‚   â”œâ”€â”€ decision_tracer_tool.py      â†’ ì˜ì‚¬ê²°ì • ì¶”ì 
â”‚   â”œâ”€â”€ graph_client_tool.py         â†’ ê·¸ë˜í”„ DB í´ë¼ì´ì–¸íŠ¸
â”‚   â””â”€â”€ memory_adapter_tool.py       â†’ ë©”ëª¨ë¦¬ ì–´ëŒ‘í„°
â”‚
â”œâ”€â”€ .claude/                         â˜… AI ì„¤ì • ë””ë ‰í† ë¦¬
â”‚   â”œâ”€â”€ CLAUDE.md                    â†’ Meta-orchestrator ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
â”‚   â”œâ”€â”€ hooks/                       â†’ í›… ì‹œìŠ¤í…œ
â”‚   â”œâ”€â”€ session_summaries/           â†’ ì„¸ì…˜ ìš”ì•½
â”‚   â””â”€â”€ templates/                   â†’ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
â”‚
â”œâ”€â”€ tests/                           â˜… í…ŒìŠ¤íŠ¸ ì½”ë“œ
â”‚   â”œâ”€â”€ test_1_semantic_tier_e2e.py  â†’ ì˜ë¯¸ ê³„ì¸µ í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ test_2_kinetic_tier_e2e.py   â†’ ì‹¤í–‰ ê³„ì¸µ í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ pyproject.toml                   â†’ í”„ë¡œì íŠ¸ ì„¤ì • & ì˜ì¡´ì„±
â”œâ”€â”€ uv.lock                          â†’ ì˜ì¡´ì„± ë²„ì „ ì ê¸ˆ
â””â”€â”€ README.md                        â†’ í”„ë¡œì íŠ¸ ì„¤ëª…ì„œ
```

### ğŸ” **ê° í´ë”ì˜ ì—­í• **

| í´ë”/íŒŒì¼ | ì—­í•  | ë¹„ìœ  |
|---------|------|------|
| `main.py` | í”„ë¡œê·¸ë¨ì˜ ì‹œì‘ì  | íšŒì‚¬ì˜ ëŒ€í‘œì´ì‚¬ |
| `subagents/` | 11ê°œ ì „ë¬¸ AI | ê° ë¶€ì„œì˜ ì „ë¬¸ê°€ë“¤ |
| `infrastructure/` | ì‹œìŠ¤í…œ ì§€ì› | ì¸ì‚¬íŒ€, ì´ë¬´íŒ€ (ë’·ë°›ì¹¨) |
| `tools/` | ìœ í‹¸ë¦¬í‹° | ì‚¬ë¬´ìš©í’ˆ, ë„êµ¬í•¨ |
| `.claude/` | AI ì„¤ì • | íšŒì‚¬ ê·œì •ì§‘ |
| `config.py` | í™˜ê²½ ì„¤ì • | íšŒì‚¬ ì£¼ì†Œë¡ |
| `tests/` | í’ˆì§ˆ ê²€ì¦ | í’ˆì§ˆê´€ë¦¬íŒ€ |

---

## 3. ê° íŒŒì¼ì˜ ì—­í• 

### 3.1 main.py (ì§„ì…ì ) - 197ì¤„

**ì—­í• **: í”„ë¡œê·¸ë¨ì˜ ì‹œì‘ì ì´ì ì „ì²´ íë¦„ì„ ì œì–´í•˜ëŠ” ì¤‘ì•™ ì»¨íŠ¸ë¡¤ëŸ¬

**ì£¼ìš” ì½”ë“œ ë¶„ì„**:

```python
# ì¤„ 13-30: í•„ìš”í•œ ëª¨ë“ˆ ê°€ì ¸ì˜¤ê¸°
import asyncio                      # ë¹„ë™ê¸° ì²˜ë¦¬ (ì—¬ëŸ¬ ì‘ì—… ë™ì‹œì—)
from dotenv import load_dotenv       # .env íŒŒì¼ ì½ê¸°
from claude_agent_sdk import ClaudeSDKClient  # AI SDK

from subagents import (              # 11ê°œ ì „ë¬¸ ì—ì´ì „íŠ¸ ê°€ì ¸ì˜¤ê¸°
    knowledge_builder,
    quality_agent,
    research_agent,
    # ... ë‚˜ë¨¸ì§€ 8ê°œ
)

# ì¤„ 33-37: ì¸í”„ë¼ ê°€ì ¸ì˜¤ê¸° (ì„ íƒ)
try:
    from infrastructure import StructuredLogger, ...
    INFRASTRUCTURE_AVAILABLE = True  # ìˆìœ¼ë©´ True
except ImportError:
    INFRASTRUCTURE_AVAILABLE = False  # ì—†ìœ¼ë©´ False

# ì¤„ 40-71: ì´ˆê¸°í™”
async def main():
    load_dotenv()  # .env íŒŒì¼ì—ì„œ API í‚¤ ë“± ì½ê¸°
    print("í™˜ì˜ ë©”ì‹œì§€")

    # ì¸í”„ë¼ê°€ ìˆìœ¼ë©´ ì´ˆê¸°í™”
    if INFRASTRUCTURE_AVAILABLE:
        logger = StructuredLogger(...)  # ë¡œê·¸ ê¸°ë¡ ì‹œì‘
        perf_monitor = PerformanceMonitor()  # ì„±ëŠ¥ ì¸¡ì • ì‹œì‘

# ì¤„ 73-126: AI ì˜µì…˜ ì„¤ì •
options = ClaudeAgentOptions(
    model="claude-sonnet-4-5",       # ì–´ë–¤ AI ëª¨ë¸?
    permission_mode="acceptEdits",   # í¸ì§‘ ê¶Œí•œ
    system_prompt={...},             # .claude/CLAUDE.md ì½ê¸°
    allowed_tools=[...],             # ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬ë“¤
    agents={...},                    # 11ê°œ subagent ë“±ë¡
    mcp_servers={...}                # ì™¸ë¶€ ì„œë²„ ì„¤ì •
)

# ì¤„ 129-189: ëŒ€í™” ë£¨í”„
async with ClaudeSDKClient(options) as client:
    while True:
        user_input = input("You: ")  # ì‚¬ìš©ì ì§ˆë¬¸ ì…ë ¥

        if user_input == "exit":
            break  # ì¢…ë£Œ

        await client.query(user_input)  # AIì—ê²Œ ì§ˆë¬¸

        # AI ë‹µë³€ ë°›ì•„ì„œ ì¶œë ¥
        async for message in client.receive_response():
            print(message)

# ì¤„ 191-197: í”„ë¡œê·¸ë¨ ì‹œì‘
if __name__ == "__main__":
    nest_asyncio.apply()  # ë¹„ë™ê¸° ì¤€ë¹„
    asyncio.run(main())   # main() ì‹¤í–‰
```

**ì´ˆë³´ìë¥¼ ìœ„í•œ ì„¤ëª…**:
- `async`ì™€ `await`: "ë™ì‹œì— ì—¬ëŸ¬ ì¼ì„ í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë§ˆë²•"
- `import`: "ë‹¤ë¥¸ íŒŒì¼ì˜ ì½”ë“œë¥¼ ê°€ì ¸ì™€ì„œ ì“°ê² ë‹¤"
- `while True`: "ì‚¬ìš©ìê°€ exitì„ ì…ë ¥í•  ë•Œê¹Œì§€ ê³„ì† ë°˜ë³µ"
- `try-except`: "ì—ëŸ¬ê°€ ë‚˜ë©´ ë¬´ì‹œí•˜ê³  ê³„ì† ì§„í–‰"

---

### 3.2 subagents/__init__.py (ì—ì´ì „íŠ¸ ëª¨ìŒ) - 45ì¤„

**ì—­í• **: 11ê°œ ì „ë¬¸ ì—ì´ì „íŠ¸ë¥¼ í•˜ë‚˜ë¡œ ë¬¶ì–´ì„œ main.pyì— ì œê³µ

```python
# ì¤„ 13-18: í•µì‹¬ ìˆ˜í•™ êµìœ¡ ì—ì´ì „íŠ¸ (6ê°œ)
from .file_builder_agent import knowledge_builder
from .validator_agent import quality_agent
from .web_research_agent import research_agent
# ...

# ì¤„ 20-27: í™•ì¥ ê¸°ëŠ¥ & ì‹œìŠ¤í…œ ê°œì„  (5ê°œ)
from .graph_query_agent import neo4j_query_agent
from .personalization_agent import personalization_engine_agent
# ...

# ì¤„ 29-44: ì™¸ë¶€ì— ê³µê°œí•  ì´ë¦„ë“¤
__all__ = [
    "knowledge_builder",
    "quality_agent",
    # ... ì´ 11ê°œ
]
```

**ë¹„ìœ **:
- íšŒì‚¬ì˜ ì¡°ì§ë„ ê°™ì€ ì—­í• 
- "ì—°êµ¬íŒ€ì€ 3ì¸µ, ê°œë°œíŒ€ì€ 4ì¸µ"ì²˜ëŸ¼ ê° ì „ë¬¸ê°€ê°€ ì–´ë”” ìˆëŠ”ì§€ ì•Œë ¤ì¤Œ

---

### 3.3 subagents/file_builder_agent.py (íŒŒì¼ ìƒì„± ì „ë¬¸ê°€) - 164ì¤„

**ì—­í• **: Obsidian ë§ˆí¬ë‹¤ìš´ íŒŒì¼ì„ ìƒì„±í•˜ëŠ” ì „ë¬¸ AI

```python
# ì¤„ 11: AgentDefinitionìœ¼ë¡œ ì—ì´ì „íŠ¸ ì •ì˜
from claude_agent_sdk import AgentDefinition

# ì¤„ 13-163: ì—ì´ì „íŠ¸ ì„¤ì •
knowledge_builder = AgentDefinition(
    # ì¤„ 14: ê°„ë‹¨í•œ ì„¤ëª…
    description="ìˆ˜í•™ ê°œë… íŒŒì¼ì„ ë§Œë“œëŠ” ì „ë¬¸ê°€",

    # ì¤„ 16-151: ìƒì„¸í•œ ì‘ì—… ì§€ì¹¨ì„œ (í”„ë¡¬í”„íŠ¸)
    prompt="""
    # ë‹¹ì‹ ì˜ ì—­í• 
    - íŒŒì¼ ìƒì„± ì „ë¬¸ê°€
    - LaTeX ìˆ˜ì‹ ì „ë¬¸ê°€
    - ìœ„í‚¤ë§í¬ ì—°ê²° ì „ë¬¸ê°€

    # ì‘ì—… íë¦„
    1. ì—°êµ¬ ë°ì´í„° ë°›ê¸°
    2. ë¶„ì„ & ë¶„í•´
    3. Obsidian íŒŒì¼ ìƒì„±
    4. íŒŒì¼ ì €ì¥
    5. ê²€ì¦
    """,

    # ì¤„ 153: ì–´ë–¤ AI ëª¨ë¸ ì‚¬ìš©?
    model="sonnet",

    # ì¤„ 155-162: ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬ë“¤
    tools=[
        'Read',    # íŒŒì¼ ì½ê¸°
        'Write',   # íŒŒì¼ ì“°ê¸°
        'Edit',    # íŒŒì¼ ìˆ˜ì •
        'Grep',    # íŒŒì¼ ê²€ìƒ‰
        'Glob',    # íŒŒì¼ ì°¾ê¸°
        'TodoWrite'  # í•  ì¼ ëª©ë¡
    ]
)
```

**ì´ˆë³´ìë¥¼ ìœ„í•œ ì„¤ëª…**:
- `AgentDefinition`: "ì—ì´ì „íŠ¸ë¥¼ ì •ì˜í•˜ëŠ” ì„¤ê³„ë„"
- `description`: "ì´ ì—ì´ì „íŠ¸ê°€ ë­˜ í•˜ëŠ”ì§€ í•œ ì¤„ ìš”ì•½"
- `prompt`: "ì—ì´ì „íŠ¸ì—ê²Œ ì£¼ëŠ” ìƒì„¸í•œ ì‘ì—… ì§€ì¹¨ì„œ"
- `tools`: "ì—ì´ì „íŠ¸ê°€ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë„êµ¬ë“¤"

**ì˜ˆì‹œ**:
```
ì‚¬ìš©ì: "í”¼íƒ€ê³ ë¼ìŠ¤ ì •ë¦¬ íŒŒì¼ ë§Œë“¤ì–´ì¤˜"
  â†“
Meta-orchestrator: knowledge_builderì—ê²Œ Task ìœ„ì„
  â†“
knowledge_builder:
  1. Write ë„êµ¬ë¡œ íŒŒì¼ ìƒì„±
  2. LaTeXë¡œ ìˆ˜ì‹ ì‘ì„±: $a^2 + b^2 = c^2$
  3. ìœ„í‚¤ë§í¬ë¡œ ì—°ê²°: [[ì§ê°ì‚¼ê°í˜•]]
  4. Read ë„êµ¬ë¡œ ê²€ì¦
  â†“
ì™„ë£Œ!
```

---

### 3.4 infrastructure/logging_service.py (ë¡œê·¸ ê¸°ë¡) - 413ì¤„

**ì—­í• **: ëˆ„ê°€, ì–¸ì œ, ë¬´ì—‡ì„, ì–´ë–»ê²Œ í–ˆëŠ”ì§€ ê¸°ë¡

```python
# ì¤„ 26: trace_idë¡œ ì‘ì—… ì¶”ì 
trace_id_var = ContextVar('trace_id', default=None)

# ì¤„ 29-46: ë¡œê·¸ ì—”íŠ¸ë¦¬ êµ¬ì¡°
@dataclass
class LogEntry:
    timestamp: str      # ì–¸ì œ?
    trace_id: str       # ì–´ëŠ ì‘ì—…?
    event_type: str     # ë¬´ìŠ¨ ì´ë²¤íŠ¸?
    agent_name: str     # ëˆ„ê°€?
    level: str          # ì¤‘ìš”ë„? (INFO, ERROR, ...)
    message: str        # ë©”ì‹œì§€
    duration_ms: float  # ì–¼ë§ˆë‚˜ ê±¸ë ¸ë‚˜?

# ì¤„ 203-365: StructuredLogger í´ë˜ìŠ¤
class StructuredLogger:
    def __init__(self, log_dir="/tmp/math-agent-logs"):
        self.log_dir = Path(log_dir)
        self.log_file = ...  # JSONL íŒŒì¼

    def agent_start(self, agent_name, task):
        # ì—ì´ì „íŠ¸ ì‹œì‘ ê¸°ë¡
        entry = LogEntry(...)
        self._write_log(entry)

    def agent_complete(self, agent_name, duration, success):
        # ì—ì´ì „íŠ¸ ì™„ë£Œ ê¸°ë¡
        entry = LogEntry(...)
        self._write_log(entry)
```

**ì´ˆë³´ìë¥¼ ìœ„í•œ ì„¤ëª…**:
- **ë¡œê·¸(Log)**: í”„ë¡œê·¸ë¨ì´ ë¬´ìŠ¨ ì¼ì„ í–ˆëŠ”ì§€ ê¸°ë¡í•˜ëŠ” ì¼ê¸°ì¥
- **trace_id**: ì—¬ëŸ¬ ì‘ì—…ì„ ì¶”ì í•  ìˆ˜ ìˆëŠ” "ì‘ì—… ë²ˆí˜¸"
- **JSONL**: JSON í˜•ì‹ìœ¼ë¡œ í•œ ì¤„ì”© ì €ì¥í•˜ëŠ” íŒŒì¼ í˜•ì‹

**ì˜ˆì‹œ**:
```
[2025-10-16 10:30:15] START knowledge_builder: í”¼íƒ€ê³ ë¼ìŠ¤ ì •ë¦¬ íŒŒì¼ ìƒì„±
[2025-10-16 10:30:17] Tool call: Write (12ms)
[2025-10-16 10:30:18] âœ… knowledge_builder: 2500ms
```

---

### 3.5 infrastructure/monitoring_service.py (ì„±ëŠ¥ ì¸¡ì •)

**ì—­í• **: ê° ì‘ì—…ì´ ì–¼ë§ˆë‚˜ ë¹ ë¥¸ì§€, ì–¼ë§ˆë‚˜ ìì£¼ ì‹¤íŒ¨í•˜ëŠ”ì§€ ì¸¡ì •

```python
class PerformanceMonitor:
    def __init__(self):
        self.metrics = {}  # ì¸¡ì • ë°ì´í„° ì €ì¥

    def record_execution(self, agent_name, duration_ms, success):
        # ì‹¤í–‰ ì‹œê°„ê³¼ ì„±ê³µ ì—¬ë¶€ ê¸°ë¡
        if agent_name not in self.metrics:
            self.metrics[agent_name] = AgentMetrics()

        self.metrics[agent_name].total_calls += 1
        self.metrics[agent_name].total_duration_ms += duration_ms
        if success:
            self.metrics[agent_name].success_count += 1

    def print_summary(self):
        # í†µê³„ ì¶œë ¥
        for agent, metrics in self.metrics.items():
            avg_duration = metrics.total_duration_ms / metrics.total_calls
            success_rate = metrics.success_count / metrics.total_calls
            print(f"{agent}: í‰ê·  {avg_duration:.0f}ms, ì„±ê³µë¥  {success_rate:.1%}")
```

**ë¹„ìœ **:
- íšŒì‚¬ì˜ ì—…ë¬´ ì„±ê³¼ í‰ê°€ ì‹œìŠ¤í…œ
- "AíŒ€ì€ í‰ê·  2ë¶„ ê±¸ë¦¼, ì„±ê³µë¥  95%"

---

### 3.6 infrastructure/error_service.py (ì—ëŸ¬ ì²˜ë¦¬)

**ì—­í• **: ë¬¸ì œê°€ ìƒê¸°ë©´ ìë™ìœ¼ë¡œ ì¬ì‹œë„í•˜ê±°ë‚˜ ì‚¬ëŒì—ê²Œ ì•Œë¦¼

```python
class ErrorTracker:
    def __init__(self, max_retries=3):
        self.max_retries = max_retries  # ìµœëŒ€ 3ë²ˆ ì¬ì‹œë„
        self.error_history = []

    def record_error(self, agent_name, task_id, error, context):
        # ì—ëŸ¬ ë°œìƒ ê¸°ë¡
        self.error_history.append({
            'agent': agent_name,
            'task': task_id,
            'error': str(error),
            'context': context,
            'timestamp': datetime.now()
        })

    async def resilient_task(self, task_func, *args, **kwargs):
        # ìë™ ì¬ì‹œë„
        for attempt in range(self.max_retries):
            try:
                return await task_func(*args, **kwargs)
            except Exception as e:
                if attempt < self.max_retries - 1:
                    await asyncio.sleep(2 ** attempt)  # 1ì´ˆ, 2ì´ˆ, 4ì´ˆ ëŒ€ê¸°
                    continue
                else:
                    raise  # 3ë²ˆ ì‹¤íŒ¨í•˜ë©´ í¬ê¸°
```

**ë¹„ìœ **:
- ì „í™”ë¥¼ ê±¸ì—ˆëŠ”ë° ì•ˆ ë°›ìœ¼ë©´ ëª‡ ë²ˆ ë” ì‹œë„í•˜ëŠ” ê²ƒ
- 3ë²ˆ ì‹œë„í•´ë„ ì•ˆ ë˜ë©´ í¬ê¸°

---

### 3.7 config.py (ì„¤ì • íŒŒì¼) - 123ì¤„

**ì—­í• **: í”„ë¡œì íŠ¸ì˜ ëª¨ë“  ê²½ë¡œì™€ ë””ë ‰í† ë¦¬ë¥¼ ê´€ë¦¬

```python
# ì¤„ 12-35: í”„ë¡œì íŠ¸ ë£¨íŠ¸ ì°¾ê¸°
def find_project_root():
    current = Path(__file__)  # config.pyì˜ ìœ„ì¹˜

    # pyproject.tomlì´ë‚˜ .git í´ë”ë¥¼ ì°¾ì„ ë•Œê¹Œì§€ ìƒìœ„ë¡œ ì˜¬ë¼ê°
    for parent in [current] + list(current.parents):
        if (parent / "pyproject.toml").exists():
            return parent

    raise RuntimeError("í”„ë¡œì íŠ¸ ë£¨íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")

# ì¤„ 39: í”„ë¡œì íŠ¸ ë£¨íŠ¸
PROJECT_ROOT = find_project_root()

# ì¤„ 42-56: ì£¼ìš” ë””ë ‰í† ë¦¬ë“¤
AGENTS_DIR = PROJECT_ROOT / "agents"
TESTS_DIR = PROJECT_ROOT / "tests"
TOOLS_DIR = PROJECT_ROOT / "tools"
MATH_VAULT_DIR = ...  # ìˆ˜í•™ ë…¸íŠ¸ ì €ì¥ ìœ„ì¹˜

# ì¤„ 67-81: ë””ë ‰í† ë¦¬ ìë™ ìƒì„±
def ensure_directories():
    for directory in [TESTS_DIR, TOOLS_DIR, MATH_VAULT_DIR, ...]:
        directory.mkdir(parents=True, exist_ok=True)

# ì¤„ 108: í”„ë¡œê·¸ë¨ ì‹œì‘í•˜ë©´ ìë™ ì‹¤í–‰
ensure_directories()
```

**ì´ˆë³´ìë¥¼ ìœ„í•œ ì„¤ëª…**:
- `Path`: íŒŒì¼ ê²½ë¡œë¥¼ ë‹¤ë£¨ëŠ” ë„êµ¬
- `exist_ok=True`: "ì´ë¯¸ ìˆì–´ë„ ì—ëŸ¬ ë‚´ì§€ ë§ˆ"
- `/`: ê²½ë¡œë¥¼ ì´ì–´ë¶™ì´ëŠ” ì—°ì‚°ì (ì˜ˆ: `PROJECT_ROOT / "tests"`)

**ë¹„ìœ **:
- íšŒì‚¬ì˜ ì£¼ì†Œë¡
- "ë¬¸ì„œëŠ” 3ì¸µ Aë™, ìë£ŒëŠ” 2ì¸µ Bë™"

---

## 4. ì»´í¬ë„ŒíŠ¸ ìƒí˜¸ì‘ìš©

### 4.1 ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ì‚¬ìš©ì (You)                                   â”‚
â”‚                    í„°ë¯¸ë„ì—ì„œ ì§ˆë¬¸ ì…ë ¥                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ "í”¼íƒ€ê³ ë¼ìŠ¤ ì •ë¦¬ íŒŒì¼ ë§Œë“¤ì–´ì¤˜"
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      main.py (ëŒ€í™” ë£¨í”„)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  while True:                                                   â”‚  â”‚
â”‚  â”‚      user_input = input("You: ")                               â”‚  â”‚
â”‚  â”‚      await client.query(user_input)                            â”‚  â”‚
â”‚  â”‚      async for message in client.receive_response():           â”‚  â”‚
â”‚  â”‚          print(message)                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ ClaudeSDKClientì—ê²Œ ì „ë‹¬
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ClaudeSDKClient (AI í´ë¼ì´ì–¸íŠ¸)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â€¢ .claude/CLAUDE.md ì½ì–´ì„œ system promptë¡œ ì‚¬ìš©               â”‚  â”‚
â”‚  â”‚  â€¢ 11ê°œ subagent ê´€ë¦¬                                          â”‚  â”‚
â”‚  â”‚  â€¢ MCP servers (memory-keeper, sequential-thinking) ì—°ê²°      â”‚  â”‚
â”‚  â”‚  â€¢ Task ë„êµ¬ë¥¼ í†µí•´ subagentì—ê²Œ ì‘ì—… ìœ„ì„                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚               â”‚              â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                         â”‚                        â”‚
      â”‚ Task ìœ„ì„               â”‚ ë¡œê¹…/ëª¨ë‹ˆí„°ë§           â”‚ MCP í†µì‹ 
      â–¼                         â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Subagents     â”‚   â”‚ Infrastructure   â”‚   â”‚   MCP Servers    â”‚
â”‚  (11ê°œ ì „ë¬¸ê°€)   â”‚   â”‚  (ì§€ì› ì‹œìŠ¤í…œ)    â”‚   â”‚  (ì™¸ë¶€ ì„œë¹„ìŠ¤)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ knowledge-    â”‚   â”‚ â€¢ StructuredLog  â”‚   â”‚ â€¢ memory-keeper  â”‚
â”‚   builder       â”‚   â”‚ â€¢ Performance    â”‚   â”‚ â€¢ sequential-    â”‚
â”‚ â€¢ quality-agent â”‚   â”‚   Monitor        â”‚   â”‚   thinking       â”‚
â”‚ â€¢ research-     â”‚   â”‚ â€¢ ErrorTracker   â”‚   â”‚                  â”‚
â”‚   agent         â”‚   â”‚ â€¢ ContextMgr     â”‚   â”‚                  â”‚
â”‚ â€¢ socratic-req  â”‚   â”‚ â€¢ AgentRegistry  â”‚   â”‚                  â”‚
â”‚ â€¢ neo4j-query   â”‚   â”‚                  â”‚   â”‚                  â”‚
â”‚ â€¢ problem-      â”‚   â”‚                  â”‚   â”‚                  â”‚
â”‚   decomposer    â”‚   â”‚                  â”‚   â”‚                  â”‚
â”‚ â€¢ problem-      â”‚   â”‚                  â”‚   â”‚                  â”‚
â”‚   scaffolding   â”‚   â”‚                  â”‚   â”‚                  â”‚
â”‚ â€¢ personaliz.   â”‚   â”‚                  â”‚   â”‚                  â”‚
â”‚ â€¢ self-improver â”‚   â”‚                  â”‚   â”‚                  â”‚
â”‚ â€¢ meta-planning â”‚   â”‚                  â”‚   â”‚                  â”‚
â”‚ â€¢ meta-query    â”‚   â”‚                  â”‚   â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                         â”‚                        â”‚
      â”‚ ë„êµ¬ ì‚¬ìš©               â”‚                        â”‚
      â–¼                         â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Tools                                       â”‚
â”‚  â€¢ Read, Write, Edit (íŒŒì¼ ì¡°ì‘)                                     â”‚
â”‚  â€¢ Grep, Glob (íŒŒì¼ ê²€ìƒ‰)                                            â”‚
â”‚  â€¢ TodoWrite (ì‘ì—… ì¶”ì )                                             â”‚
â”‚  â€¢ graph_client_tool (Neo4j)                                        â”‚
â”‚  â€¢ weight_calculator_tool                                           â”‚
â”‚  â€¢ feedback_collector_tool                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4.2 ì‹¤ì œ ì‘ì—… íë¦„ ì˜ˆì‹œ

**ì‹œë‚˜ë¦¬ì˜¤**: ì‚¬ìš©ìê°€ "í”¼íƒ€ê³ ë¼ìŠ¤ ì •ë¦¬ íŒŒì¼ ë§Œë“¤ì–´ì¤˜"ë¼ê³  ì…ë ¥

```
Step 1: ì‚¬ìš©ì ì…ë ¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì‚¬ìš©ì        â”‚
â”‚  "í”¼íƒ€ê³ ë¼ìŠ¤   â”‚
â”‚   ì •ë¦¬ íŒŒì¼    â”‚
â”‚   ë§Œë“¤ì–´ì¤˜"    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ main.py: user_input = input("You: ")                  â”‚
â”‚         await client.query(user_input)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼

Step 2: Meta-orchestrator íŒë‹¨ (.claude/CLAUDE.md)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ClaudeSDKClient:                                       â”‚
â”‚ "íŒŒì¼ ìƒì„±ì´ í•„ìš”í•˜ë„¤. ë¨¼ì € research-agentì—ê²Œ         â”‚
â”‚  í”¼íƒ€ê³ ë¼ìŠ¤ ì •ë¦¬ë¥¼ ì¡°ì‚¬í•˜ê²Œ í•˜ê³ , ê·¸ ê²°ê³¼ë¥¼            â”‚
â”‚  knowledge-builderì—ê²Œ ë„˜ê²¨ì„œ íŒŒì¼ ìƒì„±í•˜ì"           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                     â”‚
         â–¼                                     â–¼

Step 3a: ì—°êµ¬ ë‹¨ê³„                    Step 3b: ë¡œê¹… ì‹œì‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Task ë„êµ¬ ì‚¬ìš©:      â”‚            â”‚ StructuredLogger:    â”‚
â”‚ research-agentì—ê²Œ   â”‚            â”‚ agent_start(         â”‚
â”‚ "í”¼íƒ€ê³ ë¼ìŠ¤ ì •ë¦¬     â”‚            â”‚   "research-agent",  â”‚
â”‚  ì¡°ì‚¬" ìš”ì²­          â”‚            â”‚   "í”¼íƒ€ê³ ë¼ìŠ¤ ì¡°ì‚¬"  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ )                    â”‚
       â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ research-agent ì‹¤í–‰:                                 â”‚
â”‚  1. WebSearch ë„êµ¬ë¡œ "í”¼íƒ€ê³ ë¼ìŠ¤ ì •ë¦¬" ê²€ìƒ‰          â”‚
â”‚  2. ì—¬ëŸ¬ ì¶œì²˜ì—ì„œ ì •ë³´ ìˆ˜ì§‘                          â”‚
â”‚  3. ì •ì˜, ì¦ëª…, ì˜ˆì‹œ, ì‘ìš© ì •ë¦¬                      â”‚
â”‚  4. ê²°ê³¼ ë°˜í™˜                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ ì—°êµ¬ ê²°ê³¼
       â–¼

Step 4: íŒŒì¼ ìƒì„±
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Task ë„êµ¬ ì‚¬ìš©:                                      â”‚
â”‚ knowledge-builderì—ê²Œ ì—°êµ¬ ê²°ê³¼ì™€ í•¨ê»˜               â”‚
â”‚ "Obsidian íŒŒì¼ ìƒì„±" ìš”ì²­                            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ knowledge-builder ì‹¤í–‰:                              â”‚
â”‚  1. ì—°êµ¬ ê²°ê³¼ ë¶„ì„                                   â”‚
â”‚  2. YAML frontmatter ìƒì„±                            â”‚
â”‚     - type: theorem                                  â”‚
â”‚     - prerequisites: [[ì§ê°ì‚¼ê°í˜•]], [[ì œê³±]]        â”‚
â”‚  3. LaTeX ìˆ˜ì‹ ì‘ì„±                                  â”‚
â”‚     $$a^2 + b^2 = c^2$$                              â”‚
â”‚  4. Write ë„êµ¬ë¡œ íŒŒì¼ ì €ì¥                           â”‚
â”‚     /math-vault/Theorems/pythagorean-theorem.md      â”‚
â”‚  5. Read ë„êµ¬ë¡œ ê²€ì¦                                 â”‚
â”‚  6. ì™„ë£Œ ë³´ê³                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼

Step 5: í’ˆì§ˆ ê²€ì¦ (ì„ íƒ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Task ë„êµ¬ ì‚¬ìš©:                                      â”‚
â”‚ quality-agentì—ê²Œ "íŒŒì¼ ê²€ì¦" ìš”ì²­                   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ quality-agent ì‹¤í–‰:                                  â”‚
â”‚  1. Read ë„êµ¬ë¡œ íŒŒì¼ ì½ê¸°                            â”‚
â”‚  2. YAML ë¬¸ë²• ê²€ì¦ âœ…                                â”‚
â”‚  3. LaTeX ë¬¸ë²• ê²€ì¦ âœ…                               â”‚
â”‚  4. ìœ„í‚¤ë§í¬ í˜•ì‹ ê²€ì¦ âœ…                            â”‚
â”‚  5. í•„ìˆ˜ ì„¹ì…˜ ì¡´ì¬ ì—¬ë¶€ ê²€ì¦ âœ…                      â”‚
â”‚  6. ê²€ì¦ ê²°ê³¼ ë³´ê³                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼

Step 6: ì‚¬ìš©ìì—ê²Œ ê²°ê³¼ ë³´ê³ 
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ClaudeSDKClient â†’ main.py:                           â”‚
â”‚ "âœ… í”¼íƒ€ê³ ë¼ìŠ¤ ì •ë¦¬ íŒŒì¼ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤.             â”‚
â”‚  ê²½ë¡œ: /math-vault/Theorems/pythagorean-theorem.md   â”‚
â”‚  - ì •ì˜ âœ…                                           â”‚
â”‚  - ì¦ëª… âœ…                                           â”‚
â”‚  - ì˜ˆì‹œ 3ê°œ âœ…                                       â”‚
â”‚  - ì„ ìˆ˜ ì§€ì‹: [[ì§ê°ì‚¼ê°í˜•]], [[ì œê³±]] âœ…            â”‚
â”‚  - ì‘ìš©: [[ê±°ë¦¬ ê³µì‹]], [[ì‚¼ê°í•¨ìˆ˜]] âœ…              â”‚
â”‚  í’ˆì§ˆ ê²€ì¦ ì™„ë£Œ âœ…"                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì‚¬ìš©ì        â”‚
â”‚  í™”ë©´ì— ê²°ê³¼   â”‚
â”‚  ì¶œë ¥ë¨        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. ì½”ë“œ ë ˆë²¨ ìƒì„¸ ë¶„ì„

### 5.1 main.py í•µì‹¬ ì½”ë“œ íë¦„

```python
# ============================================================
# STEP 1: í”„ë¡œê·¸ë¨ ì§„ì…ì  (ìµœí•˜ë‹¨, ì¤„ 191-197)
# ============================================================
if __name__ == "__main__":
    """
    ì´ ì¡°ê±´ë¬¸ì€ "ì´ íŒŒì¼ì´ ì§ì ‘ ì‹¤í–‰ë  ë•Œë§Œ ì•„ë˜ ì½”ë“œ ì‹¤í–‰"
    ë‹¤ë¥¸ íŒŒì¼ì—ì„œ importí•˜ë©´ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
    """

    # ë¹„ë™ê¸°(async) í•¨ìˆ˜ë¥¼ ì¤‘ì²©í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ì„¤ì •
    # (Jupyter notebook ë“±ì—ì„œ í•„ìš”)
    import nest_asyncio
    nest_asyncio.apply()

    # asyncio.run()ì€ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ëŠ” ëª…ë ¹
    # main() í•¨ìˆ˜ê°€ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
    asyncio.run(main())


# ============================================================
# STEP 2: main() í•¨ìˆ˜ - í”„ë¡œê·¸ë¨ì˜ ì‹¤ì œ ì‹œì‘ (ì¤„ 40-189)
# ============================================================
async def main():
    """
    async def: ë¹„ë™ê¸° í•¨ìˆ˜ ì •ì˜
    ë¹„ë™ê¸° = ì—¬ëŸ¬ ì‘ì—…ì„ ë™ì‹œì— ì²˜ë¦¬í•  ìˆ˜ ìˆìŒ
    """

    # -------------------- ì´ˆê¸°í™” --------------------

    # .env íŒŒì¼ì—ì„œ í™˜ê²½ë³€ìˆ˜ ì½ê¸° (ì˜ˆ: ANTHROPIC_API_KEY)
    load_dotenv()

    # í™˜ì˜ ë©”ì‹œì§€ ì¶œë ¥
    print("=" * 80)
    print("Math Education Multi-Agent System v3.0")
    print("=" * 80)

    # -------------------- ì¸í”„ë¼ ì´ˆê¸°í™” (ì„ íƒ) --------------------

    logger = None
    perf_monitor = None
    error_tracker = None

    # infrastructure ëª¨ë“ˆì´ ìˆìœ¼ë©´ ì´ˆê¸°í™”
    if INFRASTRUCTURE_AVAILABLE:
        logger = StructuredLogger(log_dir="/tmp/math-agent-logs")
        # â†’ ë¡œê·¸ íŒŒì¼: /tmp/math-agent-logs/agent-20251016.jsonl

        perf_monitor = PerformanceMonitor()
        # â†’ ì„±ëŠ¥ ì¸¡ì • ì‹œì‘

        error_tracker = ErrorTracker(max_retries=3)
        # â†’ ì—ëŸ¬ ë°œìƒ ì‹œ ìµœëŒ€ 3ë²ˆ ì¬ì‹œë„

        logger.system_event("system_start", "Math agent system starting")
        # â†’ ë¡œê·¸ì— ê¸°ë¡: [2025-10-16 10:30:00] SYSTEM START

    # -------------------- AI ì˜µì…˜ ì„¤ì • --------------------

    options = ClaudeAgentOptions(
        # ì–´ë–¤ AI ëª¨ë¸ì„ ì‚¬ìš©í• ì§€
        model="claude-sonnet-4-5-20250929",

        # íŒŒì¼ í¸ì§‘ ê¶Œí•œ (acceptEdits = ìë™ ìŠ¹ì¸)
        permission_mode="acceptEdits",

        # ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸: .claude/CLAUDE.md íŒŒì¼ì„ ì½ì–´ì„œ ì‚¬ìš©
        system_prompt={
            "type": "preset",
            "preset": "claude_code"
        },
        setting_sources=["project"],  # í”„ë¡œì íŠ¸ ì„¤ì • ì½ê¸°

        # Meta-orchestratorê°€ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë„êµ¬ë“¤
        allowed_tools=[
            'Task',      # subagentì—ê²Œ ì‘ì—… ìœ„ì„ (í•µì‹¬!)
            'Read',      # íŒŒì¼ ì½ê¸°
            'Write',     # íŒŒì¼ ì“°ê¸°
            'Edit',      # íŒŒì¼ ìˆ˜ì •
            'Grep',      # íŒŒì¼ ë‚´ìš© ê²€ìƒ‰
            'Glob',      # íŒŒì¼ ì´ë¦„ ê²€ìƒ‰
            'TodoWrite', # ì‘ì—… ëª©ë¡ ê´€ë¦¬
            'mcp__sequential-thinking__sequentialthinking',  # ìˆœì°¨ ì‚¬ê³ 
            'mcp__memory-keeper__context_save',    # ë©”ëª¨ë¦¬ ì €ì¥
            'mcp__memory-keeper__context_get',     # ë©”ëª¨ë¦¬ ì½ê¸°
            'mcp__memory-keeper__context_search',  # ë©”ëª¨ë¦¬ ê²€ìƒ‰
        ],

        # 11ê°œ subagent ë“±ë¡
        agents={
            "knowledge-builder": knowledge_builder,  # subagents/file_builder_agent.py
            "quality-agent": quality_agent,          # subagents/validator_agent.py
            "research-agent": research_agent,        # subagents/web_research_agent.py
            # ... ë‚˜ë¨¸ì§€ 8ê°œ
        },

        # MCP (Model Context Protocol) ì„œë²„ë“¤
        mcp_servers={
            "memory-keeper": {
                "command": "npx",
                "args": ["-y", "mcp-memory-keeper"]
                # â†’ npx -y mcp-memory-keeper ì‹¤í–‰
            },
            "sequential-thinking": {
                "command": "npx",
                "args": ["-y", "@modelcontextprotocol/server-sequential-thinking"]
                # â†’ npx -y @modelcontextprotocol/server-sequential-thinking ì‹¤í–‰
            },
        }
    )

    # -------------------- ëŒ€í™” ë£¨í”„ ì‹œì‘ --------------------

    # ClaudeSDKClientë¥¼ ì´ˆê¸°í™”í•˜ê³  ëŒ€í™” ì‹œì‘
    # async with: ì‘ì—…ì´ ëë‚˜ë©´ ìë™ìœ¼ë¡œ ì •ë¦¬ (ë¦¬ì†ŒìŠ¤ í•´ì œ)
    async with ClaudeSDKClient(options=options) as client:
        print("ğŸ¯ Meta-Orchestrator ready. Type your request below.")
        print()

        conversation_turns = 0  # ëŒ€í™” íšŸìˆ˜ ì¹´ìš´í„°

        # -------------------- ë¬´í•œ ë£¨í”„ --------------------

        while True:
            """
            while True: ì¡°ê±´ì´ í•­ìƒ ì°¸ì´ë¯€ë¡œ ë¬´í•œ ë°˜ë³µ
            breakë¥¼ ë§Œë‚  ë•Œê¹Œì§€ ê³„ì† ì‹¤í–‰
            """

            # ========== ì‚¬ìš©ì ì…ë ¥ ë°›ê¸° ==========
            try:
                user_input = input("\033[1;34mYou:\033[0m ")
                # \033[1;34m = íŒŒë€ìƒ‰, \033[0m = ìƒ‰ìƒ ë¦¬ì…‹
                # input()ì€ ì‚¬ìš©ìê°€ Enterë¥¼ ëˆ„ë¥¼ ë•Œê¹Œì§€ ëŒ€ê¸°

            except (EOFError, KeyboardInterrupt):
                # Ctrl+D (EOFError) ë˜ëŠ” Ctrl+C (KeyboardInterrupt) ì…ë ¥ ì‹œ
                print("\n\nExiting...")
                break  # while ë£¨í”„ íƒˆì¶œ

            # ========== ì¢…ë£Œ ëª…ë ¹ í™•ì¸ ==========
            if user_input.lower() in ['exit', 'quit', 'q']:
                print("\nGoodbye!")
                if logger:
                    logger.system_event("system_shutdown", "User exit")
                if perf_monitor:
                    perf_monitor.print_summary()  # í†µê³„ ì¶œë ¥
                break  # while ë£¨í”„ íƒˆì¶œ

            # ========== ë¹ˆ ì…ë ¥ ë¬´ì‹œ ==========
            if not user_input.strip():
                continue  # ë‹¤ì‹œ while ì‹œì‘ìœ¼ë¡œ (ì…ë ¥ ëŒ€ê¸°)

            # ========== ëŒ€í™” íšŸìˆ˜ ì¦ê°€ ==========
            conversation_turns += 1

            # ========== AIì—ê²Œ ì§ˆë¬¸ ì „ì†¡ ë° ì‘ë‹µ ë°›ê¸° ==========
            try:
                print(f"\n\033[1;32mğŸ¯ Meta-Orchestrator:\033[0m ", end="", flush=True)
                # end="": ì¤„ë°”ê¿ˆ ì•ˆ í•¨, flush=True: ì¦‰ì‹œ ì¶œë ¥

                # AIì—ê²Œ ì§ˆë¬¸ ì „ì†¡ (ë¹„ë™ê¸°)
                await client.query(user_input)
                # await: ì´ ì‘ì—…ì´ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼

                # ========== ì‘ë‹µ ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬ ==========
                from claude_agent_sdk import types

                # client.receive_response()ëŠ” ë¹„ë™ê¸° ì œë„ˆë ˆì´í„°
                # ì‘ë‹µì´ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ í•˜ë‚˜ì”© ì²˜ë¦¬
                async for message in client.receive_response():

                    if isinstance(message, types.AssistantMessage):
                        # AIì˜ ë©”ì‹œì§€
                        for block in message.content:

                            if isinstance(block, types.TextBlock):
                                # ì¼ë°˜ í…ìŠ¤íŠ¸
                                print(block.text, end="", flush=True)

                            elif isinstance(block, types.ThinkingBlock):
                                # AIì˜ ì‚¬ê³  ê³¼ì •
                                print(f"\n\nğŸ§  [Thinking...]\n{block.thinking}", end="", flush=True)

                            elif isinstance(block, types.ToolUseBlock):
                                # ë„êµ¬ ì‚¬ìš© (ì˜ˆ: Read, Write, Task)
                                print(f"\n\nğŸ”§ [Tool: {block.name}]", end="", flush=True)

                    elif isinstance(message, types.ResultMessage):
                        # ìµœì¢… ê²°ê³¼
                        print(f"\n\nâœ… Complete (Duration: {message.duration_ms}ms, Turns: {message.num_turns})")

                        if perf_monitor:
                            # ì„±ëŠ¥ ê¸°ë¡
                            perf_monitor.record_execution(
                                "meta-orchestrator",
                                message.duration_ms,
                                True  # success
                            )

                print()  # ì‘ë‹µ ëë‚˜ë©´ ì¤„ë°”ê¿ˆ

            except Exception as e:
                # ì—ëŸ¬ ë°œìƒ ì‹œ ì²˜ë¦¬
                print(f"\n\nâŒ Error: {e}")

                if error_tracker:
                    error_tracker.record_error(
                        "meta-orchestrator",
                        str(conversation_turns),
                        e,
                        {}
                    )

                if logger:
                    logger.error("meta-orchestrator", type(e).__name__, str(e))

        # while ë£¨í”„ ì¢…ë£Œ (breakë¥¼ ë§Œë‚¨)
        # async with ë¸”ë¡ ì¢…ë£Œ â†’ client ìë™ ì •ë¦¬

    # main() í•¨ìˆ˜ ì¢…ë£Œ
```

---

### 5.2 Subagent ì •ì˜ ìƒì„¸ ë¶„ì„

**file_builder_agent.py**ì˜ AgentDefinition êµ¬ì¡°:

```python
from claude_agent_sdk import AgentDefinition

# ============================================================
# AgentDefinition: ì—ì´ì „íŠ¸ë¥¼ ì •ì˜í•˜ëŠ” ì„¤ê³„ë„
# ============================================================
knowledge_builder = AgentDefinition(

    # -------------------- description --------------------
    # ì§§ì€ ì„¤ëª… (meta-orchestratorê°€ ì–´ë–¤ agentë¥¼ ì„ íƒí• ì§€ íŒë‹¨í•  ë•Œ ì‚¬ìš©)
    description="Creates Obsidian markdown files for mathematical concepts...",

    # -------------------- prompt --------------------
    # ì—ì´ì „íŠ¸ì—ê²Œ ì£¼ëŠ” ìƒì„¸í•œ ì‘ì—… ì§€ì¹¨ì„œ
    # ì´ í…ìŠ¤íŠ¸ê°€ ì—ì´ì „íŠ¸ì˜ "system prompt"ê°€ ë¨
    prompt="""
    # ğŸ‘¤ PERSONA

    ## Role
    ë‹¹ì‹ ì€ **Knowledge File Builder**ì…ë‹ˆë‹¤.

    **ë‹¹ì‹ ì´ í•˜ëŠ” ì¼**:
    - Obsidian ë§ˆí¬ë‹¤ìš´ íŒŒì¼ ìƒì„±
    - LaTeX ìˆ˜ì‹ ì‘ì„±
    - ìœ„í‚¤ë§í¬ë¡œ ê°œë… ì—°ê²°

    **ë‹¹ì‹ ì´ í•˜ì§€ ì•ŠëŠ” ì¼**:
    - ì—°êµ¬ (research-agentê°€ í•¨)
    - ê²€ì¦ (quality-agentê°€ í•¨)

    ## Goals
    1. ì™„ì „ì„±: ëª¨ë“  ì •ë³´ í¬í•¨
    2. í˜•ì‹: Obsidian í˜¸í™˜
    3. ì •í™•ì„±: LaTeX ë¬¸ë²• ì˜¤ë¥˜ ì—†ìŒ

    ## Guardrails (ì§€ì¼œì•¼ í•  ê·œì¹™)
    - ì ˆëŒ€ ì§ì ‘ ì—°êµ¬í•˜ì§€ ë§ˆì„¸ìš”
    - ì„ ìˆ˜ ì§€ì‹(prerequisites)ì„ ë¹ ëœ¨ë¦¬ì§€ ë§ˆì„¸ìš”
    - ìœ„í‚¤ë§í¬ëŠ” [[Concept Name]] í˜•ì‹ìœ¼ë¡œ
    - ìµœëŒ€ 12ë²ˆì˜ ë„êµ¬ í˜¸ì¶œ í›„ ì¢…ë£Œ

    ---

    # WORKFLOW (ì‘ì—… íë¦„)

    ## Step 1: ì—°êµ¬ ë°ì´í„° ë°›ê¸°
    research-agentë¡œë¶€í„° ë‹¤ìŒì„ ë°›ìŠµë‹ˆë‹¤:
    - ì •ì˜
    - ì„ ìˆ˜ ì§€ì‹
    - ì‘ìš©
    - ë‚œì´ë„

    ## Step 2: ë¶„ì„ & ë¶„í•´
    ë°›ì€ ë°ì´í„°ì—ì„œ ì¶”ì¶œ:
    - prerequisites: [[ê°œë…1]], [[ê°œë…2]]
    - used-in: [[ì‘ìš©1]], [[ì‘ìš©2]]
    - domain: algebra, geometry, ...
    - level: middle-school, high-school, ...

    ## Step 3: Obsidian íŒŒì¼ ìƒì„±
    í…œí”Œë¦¿:
    ```markdown
    ---
    type: theorem | definition | ...
    prerequisites: ["[[ê°œë…1]]", "[[ê°œë…2]]"]
    ---

    # ì œëª©

    ## Definition
    ...

    ## Examples
    ...
    ```

    ## Step 4: íŒŒì¼ ì €ì¥
    Write ë„êµ¬ ì‚¬ìš©:
    - path: /home/kc-palantir/math/math-vault/Theorems/concept-name.md

    ## Step 5: ê²€ì¦
    Read ë„êµ¬ë¡œ íŒŒì¼ ì½ì–´ì„œ í™•ì¸
    """,

    # -------------------- model --------------------
    # ì–´ë–¤ AI ëª¨ë¸ì„ ì‚¬ìš©í• ì§€
    # "sonnet" = claude-sonnet-3-5 (ë¹ ë¥´ê³  ì €ë ´)
    # "opus" = claude-opus (ëŠë¦¬ì§€ë§Œ ê°•ë ¥)
    model="sonnet",

    # -------------------- tools --------------------
    # ì´ ì—ì´ì „íŠ¸ê°€ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë„êµ¬ë“¤
    tools=[
        'Read',      # íŒŒì¼ ì½ê¸°
        'Write',     # íŒŒì¼ ì“°ê¸°
        'Edit',      # íŒŒì¼ ìˆ˜ì •
        'Grep',      # íŒŒì¼ ë‚´ìš© ê²€ìƒ‰
        'Glob',      # íŒŒì¼ ì´ë¦„ ê²€ìƒ‰
        'TodoWrite', # ì‘ì—… ëª©ë¡
    ]
    # ì£¼ì˜: Task ë„êµ¬ëŠ” ì—†ìŒ â†’ ë‹¤ë¥¸ agentì—ê²Œ ìœ„ì„ ë¶ˆê°€
)
```

**ì´ˆë³´ìë¥¼ ìœ„í•œ ì„¤ëª…**:

1. **description**:
   - "ì´ ì—ì´ì „íŠ¸ëŠ” ë­˜ í•˜ëŠ” ì• ?"
   - meta-orchestratorê°€ ì´ê±¸ ë³´ê³  ì–´ë–¤ agentë¥¼ ë¶€ë¥¼ì§€ ê²°ì •

2. **prompt**:
   - "ì—ì´ì „íŠ¸ì—ê²Œ ì£¼ëŠ” ë§¤ë‰´ì–¼"
   - ì—­í• , ëª©í‘œ, ì§€ì¼œì•¼ í•  ê·œì¹™, ì‘ì—… íë¦„ì„ ìƒì„¸íˆ ì„¤ëª…

3. **model**:
   - "sonnet" vs "opus"
   - sonnet = ë¹ ë¥´ê³  ì €ë ´, ëŒ€ë¶€ë¶„ì˜ ì‘ì—…ì— ì¶©ë¶„
   - opus = ëŠë¦¬ê³  ë¹„ì‹¸ì§€ë§Œ ë³µì¡í•œ ì‘ì—…ì— ê°•í•¨

4. **tools**:
   - ì—ì´ì „íŠ¸ê°€ "í•  ìˆ˜ ìˆëŠ” ê²ƒ"ì˜ ëª©ë¡
   - Task ë„êµ¬ê°€ ì—†ìœ¼ë©´ ë‹¤ë¥¸ agentë¥¼ ë¶€ë¥¼ ìˆ˜ ì—†ìŒ

---

### 5.3 Infrastructure ìƒì„¸ ë¶„ì„

#### StructuredLogger

```python
class StructuredLogger:
    """
    JSON í˜•ì‹ìœ¼ë¡œ ë¡œê·¸ë¥¼ ê¸°ë¡í•˜ëŠ” í´ë˜ìŠ¤
    """

    def __init__(self, log_dir="/tmp/math-agent-logs", trace_id=None):
        """
        ì´ˆê¸°í™”

        Args:
            log_dir: ë¡œê·¸ íŒŒì¼ì„ ì €ì¥í•  ë””ë ‰í† ë¦¬
            trace_id: ì‘ì—… ì¶”ì  ID (ì—†ìœ¼ë©´ ìë™ ìƒì„±)
        """
        import uuid

        self.log_dir = Path(log_dir)
        self.log_dir.mkdir(parents=True, exist_ok=True)  # ë””ë ‰í† ë¦¬ ìƒì„±

        # trace_id: ì—¬ëŸ¬ ì‘ì—…ì„ ì¶”ì í•  ìˆ˜ ìˆëŠ” ê³ ìœ  ë²ˆí˜¸
        self.trace_id = trace_id or str(uuid.uuid4())[:8]  # ì˜ˆ: "a3f2c1d4"

        # ë¡œê·¸ íŒŒì¼ ê²½ë¡œ: /tmp/math-agent-logs/agent-20251016.jsonl
        self.log_file = self.log_dir / f"agent-{datetime.now().strftime('%Y%m%d')}.jsonl"

        # trace_idë¥¼ context variableì— ì €ì¥
        # â†’ ëª¨ë“  ë¹„ë™ê¸° ì‘ì—…ì—ì„œ ê°™ì€ trace_id ì‚¬ìš© ê°€ëŠ¥
        trace_id_var.set(self.trace_id)

    def _write_log(self, entry: LogEntry):
        """
        ë¡œê·¸ ì—”íŠ¸ë¦¬ë¥¼ JSONL íŒŒì¼ì— ê¸°ë¡

        JSONL = JSON Lines
        ê° ì¤„ì´ í•˜ë‚˜ì˜ JSON ê°ì²´

        ì˜ˆ:
        {"timestamp": "2025-10-16T10:30:15", "event": "agent_start", ...}
        {"timestamp": "2025-10-16T10:30:17", "event": "tool_call", ...}
        """
        with open(self.log_file, 'a', encoding='utf-8') as f:
            f.write(entry.to_json() + '\n')  # JSON ë¬¸ìì—´ + ì¤„ë°”ê¿ˆ

    def agent_start(self, agent_name, task_description, metadata=None):
        """
        ì—ì´ì „íŠ¸ ì‹œì‘ ê¸°ë¡

        Args:
            agent_name: ì—ì´ì „íŠ¸ ì´ë¦„ (ì˜ˆ: "knowledge-builder")
            task_description: ì‘ì—… ì„¤ëª… (ì˜ˆ: "í”¼íƒ€ê³ ë¼ìŠ¤ ì •ë¦¬ íŒŒì¼ ìƒì„±")
            metadata: ì¶”ê°€ ì •ë³´ (dict)
        """
        entry = LogEntry(
            timestamp=datetime.now().isoformat(),  # ISO í˜•ì‹: "2025-10-16T10:30:15"
            trace_id=self.trace_id,                # ì‘ì—… ì¶”ì  ID
            event_type="agent_start",              # ì´ë²¤íŠ¸ ì¢…ë¥˜
            agent_name=agent_name,
            level="INFO",                          # ë¡œê·¸ ë ˆë²¨
            message=f"Starting agent: {agent_name}",
            metadata={"task": task_description, **(metadata or {})}
        )
        self._write_log(entry)
        print(f"[{entry.timestamp}] START {agent_name}: {task_description}")

    def agent_complete(self, agent_name, duration_ms, success, metadata=None):
        """
        ì—ì´ì „íŠ¸ ì™„ë£Œ ê¸°ë¡

        Args:
            agent_name: ì—ì´ì „íŠ¸ ì´ë¦„
            duration_ms: ì†Œìš” ì‹œê°„ (ë°€ë¦¬ì´ˆ)
            success: ì„±ê³µ ì—¬ë¶€ (True/False)
            metadata: ì¶”ê°€ ì •ë³´
        """
        entry = LogEntry(
            timestamp=datetime.now().isoformat(),
            trace_id=self.trace_id,
            event_type="agent_complete",
            agent_name=agent_name,
            level="INFO" if success else "ERROR",
            message=f"Agent {'completed' if success else 'failed'}: {agent_name}",
            duration_ms=duration_ms,
            metadata={"success": success, **(metadata or {})}
        )
        self._write_log(entry)
        status_icon = "âœ…" if success else "âŒ"
        print(f"[{entry.timestamp}] {status_icon} {agent_name}: {duration_ms:.0f}ms")
```

**ì´ˆë³´ìë¥¼ ìœ„í•œ ì„¤ëª…**:

1. **ì™œ ë¡œê·¸ë¥¼ ê¸°ë¡í•˜ë‚˜ìš”?**
   - í”„ë¡œê·¸ë¨ì´ ë¬´ìŠ¨ ì¼ì„ í–ˆëŠ”ì§€ ì¶”ì 
   - ë¬¸ì œê°€ ìƒê¸°ë©´ ì›ì¸ íŒŒì•…
   - ì„±ëŠ¥ ë¶„ì„ (ì–´ë–¤ ì‘ì—…ì´ ëŠë¦°ì§€)

2. **JSONL í˜•ì‹ì´ë€?**
   - JSON Lines = ê° ì¤„ì´ í•˜ë‚˜ì˜ JSON
   - ì‰½ê²Œ ê²€ìƒ‰í•˜ê³  ë¶„ì„í•  ìˆ˜ ìˆìŒ
   - ì˜ˆ:
     ```jsonl
     {"event": "start", "agent": "research"}
     {"event": "complete", "agent": "research", "duration": 2500}
     ```

3. **trace_idëŠ” ì™œ í•„ìš”í•œê°€ìš”?**
   - í•˜ë‚˜ì˜ ì‘ì—…ì´ ì—¬ëŸ¬ agentë¥¼ ê±°ì¹¨
   - trace_idë¡œ ê°™ì€ ì‘ì—…ì¸ì§€ ì¶”ì 
   - ì˜ˆ:
     ```
     [trace_id: abc123] research-agent ì‹œì‘
     [trace_id: abc123] research-agent ì™„ë£Œ
     [trace_id: abc123] knowledge-builder ì‹œì‘
     [trace_id: abc123] knowledge-builder ì™„ë£Œ
     ```

---

#### PerformanceMonitor

```python
class PerformanceMonitor:
    """
    ê° ì—ì´ì „íŠ¸ì˜ ì„±ëŠ¥ì„ ì¸¡ì •í•˜ëŠ” í´ë˜ìŠ¤
    """

    def __init__(self):
        """
        ì´ˆê¸°í™”: ë¹ˆ ë”•ì…”ë„ˆë¦¬ ìƒì„±

        self.metrics êµ¬ì¡°:
        {
            "knowledge-builder": AgentMetrics(...),
            "research-agent": AgentMetrics(...),
            ...
        }
        """
        self.metrics = {}

    def record_execution(self, agent_name, duration_ms, success):
        """
        ì—ì´ì „íŠ¸ ì‹¤í–‰ ê¸°ë¡

        Args:
            agent_name: ì—ì´ì „íŠ¸ ì´ë¦„
            duration_ms: ì†Œìš” ì‹œê°„ (ë°€ë¦¬ì´ˆ)
            success: ì„±ê³µ ì—¬ë¶€
        """
        # ì²˜ìŒ ë³´ëŠ” agentë©´ ìƒˆë¡œ ìƒì„±
        if agent_name not in self.metrics:
            self.metrics[agent_name] = AgentMetrics()

        # í†µê³„ ì—…ë°ì´íŠ¸
        self.metrics[agent_name].total_calls += 1            # ì´ í˜¸ì¶œ íšŸìˆ˜
        self.metrics[agent_name].total_duration_ms += duration_ms  # ì´ ì†Œìš” ì‹œê°„
        if success:
            self.metrics[agent_name].success_count += 1      # ì„±ê³µ íšŸìˆ˜

    def print_summary(self):
        """
        í†µê³„ ì¶œë ¥

        ì˜ˆ:
        ================================
        Performance Summary
        ================================
        knowledge-builder:
          - Total calls: 10
          - Success rate: 90.0%
          - Avg duration: 2500ms
        research-agent:
          - Total calls: 8
          - Success rate: 100.0%
          - Avg duration: 3200ms
        """
        print("\n" + "=" * 50)
        print("Performance Summary")
        print("=" * 50)

        for agent_name, metrics in self.metrics.items():
            avg_duration = metrics.total_duration_ms / metrics.total_calls
            success_rate = metrics.success_count / metrics.total_calls * 100

            print(f"\n{agent_name}:")
            print(f"  - Total calls: {metrics.total_calls}")
            print(f"  - Success rate: {success_rate:.1f}%")
            print(f"  - Avg duration: {avg_duration:.0f}ms")
```

**ì´ˆë³´ìë¥¼ ìœ„í•œ ì„¤ëª…**:

1. **ì™œ ì„±ëŠ¥ì„ ì¸¡ì •í•˜ë‚˜ìš”?**
   - ì–´ë–¤ agentê°€ ëŠë¦°ì§€ íŒŒì•…
   - ìµœì í™”ê°€ í•„ìš”í•œ ë¶€ë¶„ ì°¾ê¸°
   - ì‹œê°„ì´ ì§€ë‚˜ë©´ì„œ ê°œì„ ë˜ëŠ”ì§€ í™•ì¸

2. **AgentMetricsë€?**
   ```python
   @dataclass
   class AgentMetrics:
       total_calls: int = 0         # ì´ ëª‡ ë²ˆ í˜¸ì¶œëë‚˜
       success_count: int = 0       # ê·¸ ì¤‘ ëª‡ ë²ˆ ì„±ê³µí–ˆë‚˜
       total_duration_ms: float = 0 # ì´ ì–¼ë§ˆë‚˜ ê±¸ë ¸ë‚˜
   ```

3. **í‰ê·  ì‹œê°„ ê³„ì‚°**:
   ```
   í‰ê·  = ì´ ì‹œê°„ / ì´ í˜¸ì¶œ íšŸìˆ˜
   ì˜ˆ: 5000ms / 2íšŒ = 2500ms (í‰ê·  2.5ì´ˆ)
   ```

---

## 6. í•µì‹¬ ê°œë… ì„¤ëª…

### 6.1 ë¹„ë™ê¸° (Async/Await)

**ì „í†µì ì¸ ë°©ì‹ (ë™ê¸°)**:
```python
# ë™ê¸°: í•œ ë²ˆì— í•˜ë‚˜ì”© ì²˜ë¦¬
result1 = search_web("í”¼íƒ€ê³ ë¼ìŠ¤")    # 3ì´ˆ ëŒ€ê¸°
result2 = search_web("ìœ í´ë¦¬ë“œ")      # 3ì´ˆ ëŒ€ê¸°
# ì´ 6ì´ˆ ê±¸ë¦¼
```

**ë¹„ë™ê¸° ë°©ì‹**:
```python
# ë¹„ë™ê¸°: ë™ì‹œì— ì—¬ëŸ¬ ê°œ ì²˜ë¦¬
result1_task = search_web_async("í”¼íƒ€ê³ ë¼ìŠ¤")  # ì‹œì‘ë§Œ í•˜ê³  ë„˜ì–´ê°
result2_task = search_web_async("ìœ í´ë¦¬ë“œ")    # ë™ì‹œì— ì‹œì‘
result1 = await result1_task  # ê²°ê³¼ ê¸°ë‹¤ë¦¼
result2 = await result2_task  # ê²°ê³¼ ê¸°ë‹¤ë¦¼
# ì´ 3ì´ˆ ê±¸ë¦¼ (ë™ì‹œì— ì‹¤í–‰ë˜ë¯€ë¡œ)
```

**ë¹„ìœ **:
- ë™ê¸°: ë¹¨ë˜ â†’ ì„¤ê±°ì§€ â†’ ì²­ì†Œ (ìˆœì„œëŒ€ë¡œ í•˜ë‚˜ì”©)
- ë¹„ë™ê¸°: ë¹¨ë˜+ì„¤ê±°ì§€+ì²­ì†Œ (ë™ì‹œì— ì‹œì‘, í•„ìš”í•  ë•Œ ê²°ê³¼ í™•ì¸)

---

### 6.2 AgentDefinition

**êµ¬ì¡°**:
```python
AgentDefinition(
    description="ì§§ì€ ì„¤ëª…",  # meta-orchestratorê°€ ì„ íƒí•  ë•Œ ì°¸ê³ 
    prompt="ìƒì„¸í•œ ì§€ì¹¨ì„œ",   # agentì—ê²Œ ì£¼ëŠ” ë§¤ë‰´ì–¼
    model="sonnet",         # ì–´ë–¤ AI ëª¨ë¸?
    tools=["Read", "Write"] # ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬ë“¤
)
```

**ë¹„ìœ **: ì§ì› í”„ë¡œí•„ ì¹´ë“œ
- description: "ì˜ì—…íŒ€ ê¹€ì² ìˆ˜"
- prompt: "ë‹´ë‹¹ ì—…ë¬´, ì—…ë¬´ ë°©ì‹, ì£¼ì˜ì‚¬í•­"
- model: "ì‹œë‹ˆì–´ê¸‰ (10ë…„ ê²½ë ¥)"
- tools: "ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬: ì»´í“¨í„°, ì „í™”, ì°¨ëŸ‰"

---

### 6.3 Task ë„êµ¬ì™€ Delegation

**Meta-orchestratorì˜ ì—­í• **:
```
ì‚¬ìš©ì ìš”ì²­ â†’ Meta-orchestrator ë¶„ì„
  â†“
"ì´ ì‘ì—…ì€ research-agentê°€ ì˜í•˜ê² êµ°"
  â†“
Task ë„êµ¬ ì‚¬ìš©: research-agentì—ê²Œ ìœ„ì„
  â†“
research-agent ì‹¤í–‰ í›„ ê²°ê³¼ ë°›ìŒ
  â†“
"ì´ì œ knowledge-builderì—ê²Œ íŒŒì¼ ìƒì„± ìš”ì²­"
  â†“
Task ë„êµ¬ ì‚¬ìš©: knowledge-builderì—ê²Œ ìœ„ì„
```

**ì½”ë“œ**:
```python
# main.pyì˜ allowed_toolsì— Task í¬í•¨
allowed_tools = ['Task', 'Read', 'Write', ...]

# meta-orchestratorê°€ Task ë„êµ¬ ì‚¬ìš©
Task(
    subagent_type="research-agent",
    prompt="í”¼íƒ€ê³ ë¼ìŠ¤ ì •ë¦¬ë¥¼ ì¡°ì‚¬í•´ì£¼ì„¸ìš”",
    description="í”¼íƒ€ê³ ë¼ìŠ¤ ì •ë¦¬ ì¡°ì‚¬"
)
```

---

### 6.4 MCP (Model Context Protocol)

**MCPë€?**:
- Model Context Protocol
- AIê°€ ì™¸ë¶€ ì„œë¹„ìŠ¤ì™€ í†µì‹ í•˜ëŠ” í‘œì¤€ ë°©ì‹
- ì˜ˆ: memory-keeper, sequential-thinking

**ì„¤ì •**:
```python
mcp_servers={
    "memory-keeper": {
        "command": "npx",
        "args": ["-y", "mcp-memory-keeper"]
    }
}
```

**ì‹¤í–‰ë˜ëŠ” ëª…ë ¹**:
```bash
npx -y mcp-memory-keeper
```

**ë¹„ìœ **:
- MCP server = ì™¸ë¶€ ì „ë¬¸ ì—…ì²´
- memory-keeper = ë¬¸ì„œ ë³´ê´€ì†Œ
- sequential-thinking = ë…¼ë¦¬ ì»¨ì„¤íŒ… íšŒì‚¬

---

## 7. ì‹¤ì „ ì˜ˆì œ: ì „ì²´ íë¦„ ì¶”ì 

### ì‹œë‚˜ë¦¬ì˜¤: "ì‚¼ê°í•¨ìˆ˜ íŒŒì¼ ë§Œë“¤ì–´ì¤˜"

```
[ì‚¬ìš©ì ì…ë ¥]
You: ì‚¼ê°í•¨ìˆ˜ íŒŒì¼ ë§Œë“¤ì–´ì¤˜

    â†“ input() í•¨ìˆ˜ê°€ ë¬¸ìì—´ ë°›ìŒ

[main.py: ì¤„ 138]
user_input = "ì‚¼ê°í•¨ìˆ˜ íŒŒì¼ ë§Œë“¤ì–´ì¤˜"

    â†“ await client.query(user_input)

[ClaudeSDKClient]
.claude/CLAUDE.mdë¥¼ system promptë¡œ ë¡œë“œ
ì‚¬ìš©ì ì§ˆë¬¸ ë¶„ì„...

Meta-orchestrator íŒë‹¨:
"íŒŒì¼ ìƒì„± ìš”ì²­ì´ë„¤. ë¨¼ì € research-agentë¡œ ì¡°ì‚¬í•˜ê³ ,
ê·¸ ë‹¤ìŒ knowledge-builderë¡œ íŒŒì¼ ìƒì„±í•˜ì"

    â†“ Task ë„êµ¬ ì‚¬ìš©

[research-agent í˜¸ì¶œ]
{
  "subagent_type": "research-agent",
  "prompt": "ì‚¼ê°í•¨ìˆ˜(sine, cosine, tangent)ì— ëŒ€í•´ ì¡°ì‚¬í•´ì£¼ì„¸ìš”",
  "description": "ì‚¼ê°í•¨ìˆ˜ ì¡°ì‚¬"
}

    â†“ research-agent ì‹¤í–‰

[research-agent ë‚´ë¶€]
1. WebSearch ë„êµ¬ë¡œ "ì‚¼ê°í•¨ìˆ˜ ì •ì˜" ê²€ìƒ‰
   â†’ ê²°ê³¼: sin, cos, tanì˜ ì •ì˜, ë‹¨ìœ„ì› ì„¤ëª…
2. WebSearch ë„êµ¬ë¡œ "ì‚¼ê°í•¨ìˆ˜ ê³µì‹" ê²€ìƒ‰
   â†’ ê²°ê³¼: ë§ì…ˆì •ë¦¬, ë°°ê°ê³µì‹, ë°˜ê°ê³µì‹
3. WebSearch ë„êµ¬ë¡œ "ì‚¼ê°í•¨ìˆ˜ ì‘ìš©" ê²€ìƒ‰
   â†’ ê²°ê³¼: íŒŒë™, ì§„ë™, íšŒì „ ìš´ë™

ê²°ê³¼ ì •ë¦¬:
"""
# ì‚¼ê°í•¨ìˆ˜ ì—°êµ¬ ê²°ê³¼

## ì •ì˜
- sin Î¸ = ëŒ€ë³€/ë¹—ë³€
- cos Î¸ = ì¸ì ‘ë³€/ë¹—ë³€
- tan Î¸ = ëŒ€ë³€/ì¸ì ‘ë³€

## ì„ ìˆ˜ ì§€ì‹
- ì§ê°ì‚¼ê°í˜•
- ë¹„ìœ¨ê³¼ ë¹„ë¡€
- ê°ë„

## ì£¼ìš” ê³µì‹
- sinÂ² Î¸ + cosÂ² Î¸ = 1
- tan Î¸ = sin Î¸ / cos Î¸

## ì‘ìš©
- íŒŒë™ í˜„ìƒ (ë¬¼ë¦¬)
- íšŒì „ ìš´ë™ (ê¸°í•˜)
- ì‹ í˜¸ ì²˜ë¦¬ (ê³µí•™)
"""

    â†“ ì—°êµ¬ ê²°ê³¼ ë°˜í™˜

[Meta-orchestrator]
ì—°êµ¬ ê²°ê³¼ ë°›ìŒ. ì´ì œ íŒŒì¼ ìƒì„± ë‹¨ê³„.

    â†“ Task ë„êµ¬ ì‚¬ìš©

[knowledge-builder í˜¸ì¶œ]
{
  "subagent_type": "knowledge-builder",
  "prompt": "ë‹¤ìŒ ì—°êµ¬ ê²°ê³¼ë¡œ Obsidian íŒŒì¼ì„ ìƒì„±í•´ì£¼ì„¸ìš”:\n\n[ì—°êµ¬ ê²°ê³¼ ì „ë‹¬]",
  "description": "ì‚¼ê°í•¨ìˆ˜ íŒŒì¼ ìƒì„±"
}

    â†“ knowledge-builder ì‹¤í–‰

[knowledge-builder ë‚´ë¶€]
1. ì—°êµ¬ ê²°ê³¼ ë¶„ì„
   - type: definition
   - prerequisites: [[ì§ê°ì‚¼ê°í˜•]], [[ë¹„ìœ¨]], [[ê°ë„]]
   - used-in: [[íŒŒë™]], [[íšŒì „ìš´ë™]], [[í‘¸ë¦¬ì—ë³€í™˜]]

2. Write ë„êµ¬ë¡œ íŒŒì¼ ìƒì„±
   íŒŒì¼ ê²½ë¡œ: /math-vault/Definitions/trigonometric-functions.md

   ë‚´ìš©:
   ```markdown
   ---
   type: definition
   id: trigonometric-functions
   domain: geometry
   level: high-school
   difficulty: 5
   prerequisites:
     - "[[ì§ê°ì‚¼ê°í˜•]]"
     - "[[ë¹„ìœ¨]]"
     - "[[ê°ë„]]"
   used-in:
     - "[[íŒŒë™]]"
     - "[[íšŒì „ìš´ë™]]"
     - "[[í‘¸ë¦¬ì—ë³€í™˜]]"
   ---

   # ì‚¼ê°í•¨ìˆ˜ (Trigonometric Functions)

   ## Definition
   ì§ê°ì‚¼ê°í˜•ì˜ ë³€ì˜ ë¹„ìœ¨ë¡œ ì •ì˜ë˜ëŠ” í•¨ìˆ˜ë“¤.

   $$\sin \theta = \frac{\text{opposite}}{\text{hypotenuse}}$$
   $$\cos \theta = \frac{\text{adjacent}}{\text{hypotenuse}}$$
   $$\tan \theta = \frac{\text{opposite}}{\text{adjacent}}$$

   ...
   ```

3. Read ë„êµ¬ë¡œ íŒŒì¼ ê²€ì¦
   âœ… YAML ë¬¸ë²• ì˜¬ë°”ë¦„
   âœ… LaTeX ìˆ˜ì‹ ì˜¬ë°”ë¦„
   âœ… ìœ„í‚¤ë§í¬ í˜•ì‹ ì˜¬ë°”ë¦„

ê²°ê³¼ ë°˜í™˜: "íŒŒì¼ ìƒì„± ì™„ë£Œ"

    â†“

[Meta-orchestrator]
knowledge-builder ì™„ë£Œ. ì„ íƒì ìœ¼ë¡œ quality-agent í˜¸ì¶œ ê°€ëŠ¥.

    â†“ (ì„ íƒ) Task ë„êµ¬ ì‚¬ìš©

[quality-agent í˜¸ì¶œ]
{
  "subagent_type": "quality-agent",
  "prompt": "/math-vault/Definitions/trigonometric-functions.md íŒŒì¼ì„ ê²€ì¦í•´ì£¼ì„¸ìš”",
  "description": "íŒŒì¼ í’ˆì§ˆ ê²€ì¦"
}

    â†“ quality-agent ì‹¤í–‰

[quality-agent ë‚´ë¶€]
1. Read ë„êµ¬ë¡œ íŒŒì¼ ì½ê¸°
2. YAML frontmatter ê²€ì¦
   âœ… í•„ìˆ˜ í•„ë“œ ì¡´ì¬ (type, id, domain, level, difficulty)
   âœ… prerequisites í˜•ì‹ ì˜¬ë°”ë¦„
3. LaTeX ê²€ì¦
   âœ… $...$ ìŒ ë§ìŒ
   âœ… $$...$$ ìŒ ë§ìŒ
4. ìœ„í‚¤ë§í¬ ê²€ì¦
   âœ… [[...]] í˜•ì‹ ì˜¬ë°”ë¦„
5. í•„ìˆ˜ ì„¹ì…˜ ê²€ì¦
   âœ… Definition ì„¹ì…˜ ì¡´ì¬
   âœ… Examples ì„¹ì…˜ ì¡´ì¬

ê²°ê³¼ ë°˜í™˜: "ê²€ì¦ ì™„ë£Œ, ë¬¸ì œ ì—†ìŒ"

    â†“

[Meta-orchestrator]
ëª¨ë“  ì‘ì—… ì™„ë£Œ. ì‚¬ìš©ìì—ê²Œ ë³´ê³ .

    â†“ AssistantMessage ìƒì„±

[main.py: ì¤„ 166-180]
async for message in client.receive_response():
    if isinstance(message, types.AssistantMessage):
        for block in message.content:
            if isinstance(block, types.TextBlock):
                print(block.text, end="", flush=True)

    â†“ í™”ë©´ ì¶œë ¥

[í„°ë¯¸ë„ ì¶œë ¥]
ğŸ¯ Meta-Orchestrator:

âœ… ì‚¼ê°í•¨ìˆ˜ íŒŒì¼ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤!

**íŒŒì¼ ì •ë³´**:
- ê²½ë¡œ: `/math-vault/Definitions/trigonometric-functions.md`
- íƒ€ì…: definition
- ë‚œì´ë„: 5/10 (ê³ ë“±í•™êµ ìˆ˜ì¤€)

**í¬í•¨ëœ ë‚´ìš©**:
- ì •ì˜ (sin, cos, tan)
- ì£¼ìš” ê³µì‹ (í”¼íƒ€ê³ ë¼ìŠ¤ ì •ë¦¬ ë“±)
- ì˜ˆì‹œ 3ê°œ
- ì„ ìˆ˜ ì§€ì‹: [[ì§ê°ì‚¼ê°í˜•]], [[ë¹„ìœ¨]], [[ê°ë„]]
- ì‘ìš©: [[íŒŒë™]], [[íšŒì „ìš´ë™]], [[í‘¸ë¦¬ì—ë³€í™˜]]

í’ˆì§ˆ ê²€ì¦ ì™„ë£Œ âœ…

âœ… Complete (Duration: 4500ms, Turns: 8)

[main.py: ì¤„ 181]
print()  # ì¤„ë°”ê¿ˆ

    â†“ ë‹¤ì‹œ ì…ë ¥ ëŒ€ê¸°

[main.py: ì¤„ 138]
user_input = input("\033[1;34mYou:\033[0m ")
```

---

## 8. ìš”ì•½

### í”„ë¡œê·¸ë¨ êµ¬ì¡° í•œëˆˆì—

```
python main.py
    â†“
main() í•¨ìˆ˜ ì‹¤í–‰
    â†“
ClaudeSDKClient ì´ˆê¸°í™” (11ê°œ subagent ë“±ë¡)
    â†“
while True ëŒ€í™” ë£¨í”„
    â”œâ”€ input() â†’ ì‚¬ìš©ì ì§ˆë¬¸ ë°›ê¸°
    â”œâ”€ client.query() â†’ AIì—ê²Œ ì§ˆë¬¸
    â”œâ”€ receive_response() â†’ AI ë‹µë³€ ë°›ê¸°
    â”‚   â”œâ”€ Meta-orchestrator íŒë‹¨
    â”‚   â”œâ”€ Task ë„êµ¬ë¡œ subagent ìœ„ì„
    â”‚   â”œâ”€ Subagent ì‹¤í–‰ (tools ì‚¬ìš©)
    â”‚   â””â”€ ê²°ê³¼ ìˆ˜ì§‘ ë° ì¢…í•©
    â”œâ”€ print() â†’ ì‚¬ìš©ìì—ê²Œ ê²°ê³¼ ì¶œë ¥
    â””â”€ ë‹¤ì‹œ input()ìœ¼ë¡œ
```

### ì£¼ìš” ì»´í¬ë„ŒíŠ¸

| ì»´í¬ë„ŒíŠ¸ | ì—­í•  | íŒŒì¼ |
|---------|------|------|
| main.py | ì§„ì…ì , ëŒ€í™” ë£¨í”„ | main.py |
| ClaudeSDKClient | AI í´ë¼ì´ì–¸íŠ¸ | (ì™¸ë¶€ íŒ¨í‚¤ì§€) |
| Meta-orchestrator | ì‘ì—… ì¡°ìœ¨ì | .claude/CLAUDE.md |
| 12 Subagents | ì „ë¬¸ AIë“¤ | subagents/*.py |
| Infrastructure | ë¡œê¹…, ëª¨ë‹ˆí„°ë§, ì—ëŸ¬ ì²˜ë¦¬ | infrastructure/*.py |
| Tools | ìœ í‹¸ë¦¬í‹° (Mathpix OCR í¬í•¨) | tools/*.py |
| Workflows | í”¼ë“œë°± ë£¨í”„ ì›Œí¬í”Œë¡œìš° | workflows/*.py |
| Observability | ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ | observability-server/, observability-dashboard/ |
| Config | ê²½ë¡œ ì„¤ì • | config.py |

### í•µì‹¬ ë©”ì»¤ë‹ˆì¦˜

1. **Delegation (ìœ„ì„)**:
   - Meta-orchestratorê°€ Task ë„êµ¬ë¡œ subagentì—ê²Œ ì‘ì—… ìœ„ì„
   - ê° subagentëŠ” ìê¸° ë¶„ì•¼ì˜ ì „ë¬¸ê°€

2. **Tool Restriction (ë„êµ¬ ì œí•œ)**:
   - ê° subagentëŠ” í•„ìš”í•œ ë„êµ¬ë§Œ ì‚¬ìš© ê°€ëŠ¥
   - ì˜ˆ: quality-agentëŠ” Readë§Œ ê°€ëŠ¥ (í¸ì§‘ ë¶ˆê°€)

3. **Async/Await (ë¹„ë™ê¸°)**:
   - ì—¬ëŸ¬ ì‘ì—…ì„ ë™ì‹œì— ì²˜ë¦¬
   - ì˜ˆ: ì›¹ ê²€ìƒ‰ ì¤‘ì—ë„ ë‹¤ë¥¸ ì‘ì—… ê°€ëŠ¥

4. **Observability (ê´€ì°° ê°€ëŠ¥ì„±)**:
   - StructuredLogger: ëª¨ë“  ì‘ì—… ê¸°ë¡
   - PerformanceMonitor: ì„±ëŠ¥ ì¸¡ì •
   - ErrorTracker: ì—ëŸ¬ ì¶”ì  ë° ì¬ì‹œë„

---

## 9. ì´ˆë³´ìë¥¼ ìœ„í•œ íŒ

### ì½”ë“œ ì½ëŠ” ë²•

1. **ì£¼ì„(Comments) ì°¾ê¸°**:
   ```python
   # ì´ê²ƒì€ ì£¼ì„ì…ë‹ˆë‹¤ (ì½”ë“œê°€ ì•„ë‹˜, ì„¤ëª…)
   ```

2. **í•¨ìˆ˜ ì •ì˜ ì°¾ê¸°**:
   ```python
   def function_name():  # def = define (ì •ì˜)
       # í•¨ìˆ˜ ë³¸ë¬¸
   ```

3. **í´ë˜ìŠ¤ ì •ì˜ ì°¾ê¸°**:
   ```python
   class ClassName:  # class = ê°ì²´ë¥¼ ë§Œë“œëŠ” ì„¤ê³„ë„
       def __init__(self):  # ìƒì„±ì (ì´ˆê¸°í™”)
           pass
   ```

4. **ì¡°ê±´ë¬¸ ì´í•´í•˜ê¸°**:
   ```python
   if condition:      # ë§Œì•½ conditionì´ ì°¸ì´ë©´
       do_something()
   elif other:        # ê·¸ê²Œ ì•„ë‹ˆê³  otherê°€ ì°¸ì´ë©´
       do_other()
   else:              # ê·¸ ì™¸ ëª¨ë“  ê²½ìš°
       do_default()
   ```

5. **ë°˜ë³µë¬¸ ì´í•´í•˜ê¸°**:
   ```python
   for item in items:  # itemsì˜ ê° itemì— ëŒ€í•´
       process(item)

   while condition:    # conditionì´ ì°¸ì¸ ë™ì•ˆ ê³„ì†
       do_something()
   ```

### ë””ë²„ê¹… íŒ

1. **print() ì‚¬ìš©**:
   ```python
   print(f"ë³€ìˆ˜ ê°’: {variable}")  # f-string (formatted string)
   ```

2. **ë¡œê·¸ íŒŒì¼ í™•ì¸**:
   ```bash
   tail -f /tmp/math-agent-logs/agent-20251016.jsonl
   ```

3. **ì—ëŸ¬ ë©”ì‹œì§€ ì½ê¸°**:
   ```
   Traceback (most recent call last):
     File "main.py", line 138, in main
       user_input = input("You: ")
   KeyboardInterrupt
   ```
   - ë§¨ ì•„ë˜ê°€ ì‹¤ì œ ì—ëŸ¬
   - ìœ„ë¡œ ì˜¬ë¼ê°€ë©´ì„œ í˜¸ì¶œ ê²½ë¡œ ì¶”ì 

---

## 10. ë‹¤ìŒ ë‹¨ê³„

ì´ ë¬¸ì„œë¥¼ ì´í•´í–ˆë‹¤ë©´:

1. **ì½”ë“œ ìˆ˜ì • ì—°ìŠµ**:
   - main.pyì˜ í™˜ì˜ ë©”ì‹œì§€ ë°”ê¿”ë³´ê¸°
   - subagentì˜ prompt ìˆ˜ì •í•´ë³´ê¸°

2. **ìƒˆ subagent ì¶”ê°€**:
   - subagents/example_agent.py ë§Œë“¤ê¸°
   - subagents/__init__.pyì— import ì¶”ê°€
   - main.pyì˜ agentsì— ë“±ë¡

3. **ë„êµ¬ ì¶”ê°€**:
   - tools/example_tool.py ë§Œë“¤ê¸°
   - subagentì˜ tools ëª©ë¡ì— ì¶”ê°€

4. **í…ŒìŠ¤íŠ¸ ì‘ì„±**:
   - tests/test_example.py ë§Œë“¤ê¸°
   - pytestë¡œ ì‹¤í–‰

---

## ë¶€ë¡: ìš©ì–´ ì‚¬ì „

| ìš©ì–´ | ì„¤ëª… | ì˜ˆì‹œ |
|-----|------|------|
| ë¹„ë™ê¸° (Async) | ì—¬ëŸ¬ ì‘ì—…ì„ ë™ì‹œì— ì²˜ë¦¬ | await client.query() |
| ì—ì´ì „íŠ¸ (Agent) | íŠ¹ì • ì‘ì—…ì„ í•˜ëŠ” AI | knowledge-builder |
| ë„êµ¬ (Tool) | ì—ì´ì „íŠ¸ê°€ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ | Read, Write, Task |
| ìœ„ì„ (Delegation) | ë‹¤ë¥¸ agentì—ê²Œ ì‘ì—… ë„˜ê¸°ê¸° | Task ë„êµ¬ ì‚¬ìš© |
| ë¡œê·¸ (Log) | ì‘ì—… ê¸°ë¡ | JSONL íŒŒì¼ |
| ë©”íŠ¸ë¦­ (Metric) | ì¸¡ì •ê°’ (ì‹œê°„, íšŸìˆ˜ ë“±) | duration_ms |
| í”„ë¡¬í”„íŠ¸ (Prompt) | AIì—ê²Œ ì£¼ëŠ” ì§€ì‹œ | system prompt |
| MCP | AI-ì™¸ë¶€ ì„œë¹„ìŠ¤ í†µì‹  í”„ë¡œí† ì½œ | memory-keeper |
| JSONL | JSON Lines (í•œ ì¤„ = í•˜ë‚˜ì˜ JSON) | ë¡œê·¸ íŒŒì¼ í˜•ì‹ |
| Context Variable | ë¹„ë™ê¸° ì‘ì—… ê°„ ê³µìœ ë˜ëŠ” ë³€ìˆ˜ | trace_id |

---

## 11. Feedback Loop System (NEW)

### í”¼ë“œë°± ê¸°ë°˜ í•™ìŠµ ì‹œìŠ¤í…œ

```
ì‚¬ìš©ìê°€ ìˆ˜í•™ ë¬¸ì œ ì´ë¯¸ì§€ ì œê³µ (sample.png)
    â†“
Mathpix OCRë¡œ ìˆ˜ì‹ ì¶”ì¶œ (99.9% ì •í™•ë„)
    â†“
841ê°œ ì¤‘í•™êµ ìˆ˜í•™ ê°œë…ê³¼ ë§¤ì¹­
    â†“
ë¬¸ì œ ìœ í˜•ë³„ ë§ì¶¤ Scaffolding ìƒì„±
    - ì¢Œí‘œí‰ë©´ ë¬¸ì œ: 10ë‹¨ê³„ (ì  ì°¾ê¸° â†’ êµì  â†’ ë„“ì´)
    - ì†Œì¸ìˆ˜ë¶„í•´: 9ë‹¨ê³„ (ì§ìˆ˜ íŒë³„ â†’ ë‚˜ëˆ„ê¸° â†’ ì§€ìˆ˜ í‘œê¸°)
    â†“
ì‚¬ìš©ìê°€ ê° ë‹¨ê³„ í‰ê°€ (1-5ì  + ê°œì„  ì œì•ˆ)
    â†“
Feedback-Learning-Agentê°€ íŒ¨í„´ ì¶”ì¶œ
    - "ê°€ì¥ ì‘ì€ ì†Œìˆ˜" ê°•ì¡° íŒ¨í„´
    - "why ì§ˆë¬¸" ì¶”ê°€ íŒ¨í„´
    â†“
Neo4jì— LearnedPatternìœ¼ë¡œ ì €ì¥
    â†“
ë‹¤ìŒ ë¬¸ì œ ìƒì„± ì‹œ ìë™ ì ìš©
```

### ìƒˆë¡œ ì¶”ê°€ëœ íŒŒì¼ (12ê°œ)

| íŒŒì¼ | ì—­í•  |
|-----|------|
| `tools/mathpix_ocr_tool.py` | Mathpix API OCR í†µí•© |
| `tools/feedback_collector.py` | ëŒ€í™”í˜• í”¼ë“œë°± ìˆ˜ì§‘ CLI |
| `tools/observability_hook.py` | Observability ì´ë²¤íŠ¸ ì „ì†¡ |
| `workflows/hook_events.py` | ì´ë²¤íŠ¸ íƒ€ì… ì •ì˜ |
| `workflows/concept_matcher.py` | ë¬¸ì œ-ê°œë… ë§¤ì¹­ (841ê°œ) |
| `workflows/feedback_loop_workflow.py` | ì „ì²´ ì›Œí¬í”Œë¡œìš° |
| `subagents/feedback_learning_agent.py` | íŒ¨í„´ í•™ìŠµ Agent (12ë²ˆì§¸) |
| `neo4j/feedback_schema.cypher` | Neo4j ìŠ¤í‚¤ë§ˆ í™•ì¥ |
| `scripts/run_feedback_loop.py` | CLI ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ |
| `tests/test_feedback_loop_e2e.py` | E2E í…ŒìŠ¤íŠ¸ (10ê°œ) |
| `tests/test_actual_problem_scaffolding.py` | ì‹¤ì œ ë¬¸ì œ í…ŒìŠ¤íŠ¸ |
| `tests/test_full_integration.py` | í†µí•© í…ŒìŠ¤íŠ¸ |

### Observability í†µí•©

ëª¨ë“  ì›Œí¬í”Œë¡œìš° ë‹¨ê³„ê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶”ì ë©ë‹ˆë‹¤:
- `ocr_started` â†’ `ocr_completed` (99.9% confidence)
- `concept_match_started` â†’ `concept_match_completed` (841ê°œ ì¤‘ top-5)
- `scaffolding_started` â†’ `scaffolding_completed` (10 steps)
- `feedback_started` â†’ `feedback_completed` (step-by-step)
- `learning_started` â†’ `pattern_extracted` â†’ `learning_completed`
- `neo4j_write_started` â†’ `neo4j_write_completed`

Dashboard (http://localhost:3000)ì—ì„œ ì‹¤ì‹œê°„ í™•ì¸ ê°€ëŠ¥.

---

## 12. Enhanced Observability System (indydevdan Integration)

### Claude Code Hook System

**ëª©ì **: Claudeì˜ ëª¨ë“  í–‰ë™ì„ ìë™ìœ¼ë¡œ ì¶”ì 

```
Claudeê°€ íˆ´ ì‚¬ìš© â†’ Hook ë°œë™ â†’ ìë™ ë¡œê¹… â†’ ì„œë²„ ì „ì†¡ â†’ ëŒ€ì‹œë³´ë“œ í‘œì‹œ
```

### Hook ì¢…ë¥˜ (9ê°€ì§€)

| Hook | ì‹œì  | ê¸°ëŠ¥ |
|------|------|------|
| `SessionStart` | Claude ì‹œì‘ | ì„¸ì…˜ ì´ˆê¸°í™” |
| `UserPromptSubmit` | ì‚¬ìš©ì ì…ë ¥ | ì§ˆë¬¸ ì¶”ì  |
| `PreToolUse` | íˆ´ ì‚¬ìš© ì „ | ë³´ì•ˆ ê²€ì¦ (rm -rf ì°¨ë‹¨) |
| `PostToolUse` | íˆ´ ì‚¬ìš© í›„ | ê²°ê³¼ ë¡œê¹… |
| `SubagentStop` | Subagent ì™„ë£Œ | Agent ì¶”ì  |
| `PreCompact` | ì»¨í…ìŠ¤íŠ¸ ì••ì¶• | ë©”ëª¨ë¦¬ ê´€ë¦¬ |
| `Notification` | ì‚¬ìš©ì ì•Œë¦¼ | ìƒí˜¸ì‘ìš© |
| `Stop` | ì‘ë‹µ ì™„ë£Œ | ì„¸ì…˜ ì™„ë£Œ, TTS ì•Œë¦¼ |
| `SessionEnd` | Claude ì¢…ë£Œ | ì •ë¦¬ ì‘ì—… |

### ë³´ì•ˆ ê¸°ëŠ¥

**ìë™ ì°¨ë‹¨**:
- `rm -rf` (ëª¨ë“  ë³€í˜•)
- `rm --recursive --force`
- ë£¨íŠ¸ ë””ë ‰í† ë¦¬ ì‚­ì œ
- `.env` íŒŒì¼ ì ‘ê·¼

**ì‘ë™ ë°©ì‹**:
```python
# pre_tool_use_security.py
if is_dangerous_rm_command(command):
    print("BLOCKED: Dangerous rm command")
    sys.exit(2)  # Exit 2 â†’ Claudeê°€ íˆ´ ì‹¤í–‰ ì¤‘ë‹¨
```

### AI ìš”ì•½ ìƒì„±

**ì˜ˆì‹œ**:
```
ì´ë²¤íŠ¸: PreToolUse - Read tool
í˜ì´ë¡œë“œ: {"file_path": "sample.png"}
  â†“ AI (Haiku)
ìš”ì•½: "Reads sample.png from project root"
```

### í†µí•© ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Level 1: Claude Code Hooks                  â”‚
â”‚ - ëª¨ë“  íˆ´ ì‚¬ìš© ìë™ ì¶”ì                      â”‚
â”‚ - ë³´ì•ˆ ê²€ì¦                                  â”‚
â”‚ - AI ìš”ì•½                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“ POST /events
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Level 2: Workflow Events                    â”‚
â”‚ - OCR, Scaffolding, Pattern Learning        â”‚
â”‚ - Custom event types                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“ Both â†’ Same Server
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Enhanced Observability Server               â”‚
â”‚ - FastAPI + WebSocket                       â”‚
â”‚ - SQLite (chat + summary)                   â”‚
â”‚ - Real-time broadcast                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“ WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vue Dashboard (localhost:3000)              â”‚
â”‚ - í†µí•© íƒ€ì„ë¼ì¸                              â”‚
â”‚ - AI ìš”ì•½ í‘œì‹œ                               â”‚
â”‚ - ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°ì´í„° íë¦„ ì˜ˆì‹œ

**ì‹œë‚˜ë¦¬ì˜¤**: Claudeê°€ íŒŒì¼ì„ ì½ì„ ë•Œ

```
1. PreToolUse Hook ë°œë™
   â†’ pre_tool_use_security.py: ë³´ì•ˆ ê²€ì¦ âœ…
   â†’ send_event_observability.py: ì„œë²„ ì „ì†¡
   â†’ AI: "Reads sample.png from project root"

2. Tool ì‹¤í–‰ (Read)
   â†’ Claudeê°€ íŒŒì¼ ì½ê¸°

3. PostToolUse Hook ë°œë™
   â†’ post_tool_use_logging.py: ê²°ê³¼ ë¡œê¹…
   â†’ send_event_observability.py: ì„œë²„ ì „ì†¡
   â†’ AI: "Successfully read 173 bytes"

4. Dashboard ì‹¤ì‹œê°„ í‘œì‹œ
   â†’ ğŸ”§ PreToolUse: "Reads sample.png..."
   â†’ âœ… PostToolUse: "Successfully read..."
```

### ì¶”ê°€ëœ íŒŒì¼ (18ê°œ)

**Hook Scripts** (10):
- `send_event_observability.py` - í†µí•© ì´ë²¤íŠ¸ ì „ì†¡ê¸°
- `pre_tool_use_security.py` - ë³´ì•ˆ ê²€ì¦
- `post_tool_use_logging.py` - ê²°ê³¼ ë¡œê¹…
- `stop_enhanced.py` - ì™„ë£Œ + TTS
- `user_prompt_submit.py` - ì‚¬ìš©ì ì…ë ¥
- `subagent_stop.py` - Subagent ì¶”ì 
- `session_start.py`, `session_end.py`
- `pre_compact.py`, `notification.py`

**Utilities** (5):
- `utils/constants.py`
- `utils/summarizer.py`
- `utils/llm/anth.py`
- `utils/__init__.py`, `utils/llm/__init__.py`

**Tests** (3):
- `tests/test_claude_hooks_integration.py`
- `tests/test_websocket_streaming.py`
- Updated `tests/run_all_tests.py`

---

**ë¬¸ì„œ ì‘ì„±ì¼**: 2025-10-16
**ë²„ì „**: 3.2.0 - indydevdan Observability Integration
**ì—…ë°ì´íŠ¸**: Claude Code hooks í†µí•© (19 hook scripts, WebSocket, AI summaries, Security)
**í…ŒìŠ¤íŠ¸**: 100% í†µê³¼ (5 suites, 20+ tests)
**ëŒ€ìƒ**: í”„ë¡œê·¸ë˜ë° ì´ˆë³´ì
